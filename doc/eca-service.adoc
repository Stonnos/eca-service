= Техническая документация системы ECA SERVICE
:toc:
:toc-title: Оглавление

== Введение

Программная система представляет собой серверное решение для построения различных моделей классификаторов, а также
расчёта их основных показателей точности. Система поддерживает построение одиночных и ансамблевых моделей классификаторов.

== 1. Функции системы

1. Построение одиночных и ансамблевых моделей классификаторов.
2. API Data Miner, основным предназначением которого является автоматический подбор оптимальных
параметров для одиночных и ансамблевых алгоритмов на основе серии экспериментов.
3. Наполнение базы знаний результатов классификации разнотипных данных с использованием
различных алгоритмов классификации, как одиночных так и ансамблевых.
4. API для нахождения оптимальных параметров классификаторов для конкретной обучающей выборки на основе накопленной
истории результатов классификации.
5. UI для работы с заявками на построение моделей классификаторов.
6. Возможность добавления/изменения конфигураций экспериментов через UI.
7. Административная панель для управления пользователями системы.
8. Личный кабинет пользователя с основными операциями:

    * Редактирование основных данных (ФИО и т.д.)
    * Изменение email
    * Изменение пароля
    * Восстановление пароля
    * Загрузка аватара
9. UI для сохранения файлов с обучающей выборкой в БД в виде таблиц.
10. UI для просмотра журналов аудита

== 2. Архитектура решения

=== 2.1 Диаграмма взаимодействия компонентов

На рисунке 2.1 представлена диаграмма взаимодействия основных компонентов системы Eca - service, за исключением
связей с системными сервисами мониторинга, логирования:

image::./images/es-architecture.png[alt=Диаграмма взаимодействия компонентов,scaledwidth=80%]

==== Таблица 1.1 - Описание компонентов диграммы взаимодействия

|===
|№|Компонент|Описание
|1
|Eca desktop
|Представляет собой настольное приложение ECA, установленное на ПК
|2
|Eca admin
|Представляет собой административную панель для работы с заявками на построение моделей классификаторов через web интерфейс
|3
|Eca web
|Angular приложение, обернутое в spring boot. Реализует Web клиент для работы с заявками на построение моделей классификаторов
|4
|Rabbit MQ
|Брокер сообщений на построение моделей от Eca desktop
|5
|API gateway
|Модуль единой точки входа для проксирования http запросов во внутренние микросервисы
|6
|Discovery server
|Eureka сервер для регистрации микросервисов
|7
|Eca server
|Основной модуль, который принимает сообщения для обучения моделей классификаторов. Модуль предоставляет REST API по работе с заявками для web приложения.
|8
|Eca oauth
|Модуль авторизации и управления пользователями. Для авторизации используется протокол oauth2. Модуль предоставляет REST API по работе с пользователями для web приложения.
|9
|Eca ers
|Внутренний сервис для хранения и анализа результатов классификации. Сервис предоставляет REST API для получения/сохранения результатов классификации.
|10
|Eca data storage
|Модуль для хранения обучающих выборок в виде таблиц БД. Модуль предоставляет REST API по работе с выборками для web приложения.
|11
|Eca mail
|Внутренний сервис для отправки почты и хранения шаблонов email - сообщений. Модуль предоставляет REST API для отправки нотификаций в соответствии с заданным шаблоном сообщения.
|12
|Eca web push
|Модуль для работы с центром уведомлений и отправки веб - пушей с поддержкой web sockets
|13
|Eca audit log
|Модуль для сбора и хранения событий аудита. Также модуль предоставляет REST API для получения журналов аудита в web приложении.
|14
|PostgreSQL
|База данных PostgreSQL для конкретного микросервиса
|15
|Redis
|Распределенная in-memory БД для хранения временных данных
|16
|S3 storage (minio)
|S3 хранилище для моделей классификаторов
|17
|S3 proxy (nginx)
|S3 nginx proxy для проксирования внешних запросов к S3 хранилищу
|18
|Eca data loader
|Модуль для загрузки обучающих выборок в единое хранилище S3 для последующей классификации
|===

Все API - вызовы для web - приложения должны быть авторизованы с помощью сервера авторизации eca-oauth. Клиент использует аутентификацию с помощью логина и пароля
для выдачи пары access token/refresh token. По истечении срока действия access token, клиент использует refresh token для выдачи
нового access token. Любой вызов защищенного API должен выполняться с заголовком авторизации в формате Authorization: Bearer <access token>.

=== 2.2 Диаграмма взаимодействия с системными сервисами

На рисунке 2.2 представлена полная диаграмма взаимодействия с системными сервисами:

image::./images/es-ss-architecture.png[alt=Диаграмма взаимодействия с системными сервисами,scaledwidth=80%]

==== Таблица 1.2 - Описание компонентов диграммы взаимодействия с системными сервисами

|===
|№|Компонент|Описание
|1
|Eca - service
|Система eca - service
|2
|PostgreSQL
|Сервер PostgreSQL с основными БД приложения
|3
|Rabbit MQ
|Брокер сообщений
|4
|Prometheus
|Система для сбора метрик с основных компонентов приложения
|5
|Grafana
|Web клиент для визуализации метрик из prometheus
|6
|Alertmanager
|Система для отправки уведомлений мониторинга в различные каналы
|7
|Alertmanager adapter
|Интеграционный адаптер для преобразования запросов от alertmanager в форматы для отправки в различные каналы
|8
|SMTP server
|Сервер для отправки почты с уведомлениями мониторинга
|9
|Telegram
|Telegram канал для полученя уведомлений мониторинга
|10
|Filebeat
|Система для чтения логов docker - контейнеров с последующей их отправкой в elasticsearch хранилище
|11
|Elasticsearch
|Хранилище логов для всех микросервисов
|12
|Kibana
|Web клиент для просмотра логов
|13
|Postgres Exporter
|Адаптер для получения данных мониторинга из PostgreSQL и их преобразование в формат prometheus
|14
|S3 storage (minio)
|S3 хранилище объектов minio
|===

=== 2.3 Диаграмма последовательности для построения модели классификатора

На рисунке 2.3 представлена диаграмма последовательности для построения модели классификатора:

image::./images/evaluation-request-sequence.png[alt=Диаграмма последовательности для построения модели классификатора,scaledwidth=80%]

=== 2.4 Диаграмма последовательности для построения оптимального классификатора

На рисунке 2.4 представлена диаграмма последовательности для построения оптимального классификатора:

image::./images/evaluation-optimizer-request-sequence.png[alt=Диаграмма последовательности для построения оптимального классификатора,scaledwidth=80%]

=== 2.5 Диаграмма последовательности для обработки заявки на эксперимент

На рисунке 2.5 представлена диаграмма последовательности для обработки заявки на эксперимент:

image::./images/experiment-request-sequence.png[alt=Диаграмма последовательности для обработки заявки на эксперимент,scaledwidth=80%]

== 3. Схема базы данных

:db-table-id: 0

=== 3.1 Схема БД eca-server

На рисунке 3.1 приведена схема базы данных eca-server:

image::./images/eca-db-schema.png[alt=Схема базы данных eca-server,scaledwidth=80%]

=== 3.2 Описание БД eca-server

==== Таблица 3.{counter:db-table-id} - 'classifier_info' - содержит мета информацию о классификаторах
[cols="^20%,^14%,^8%,^8%,^8%,^30%",options="header"]
|===
|Название колонки|Тип|Unique|Not NULL|Индекс|Описание
|id                      |bigint           |+|+|+                              |Идентификатор записи (первичный ключ)
|classifier_name         |varchar(255)     |-|+|-                              |Название классификатора
|classifier_options      |text             |-|+|-                              |Настройки классификатора в формате json
|===

==== Таблица 3.{counter:db-table-id} - 'classifiers_configuration' - содержит мета информацию о конфигурациях индивидуальных классификаторов для построения экспериментов с использованием ансамблевых алгоритмов
[cols="^20%,^14%,^8%,^8%,^8%,^30%",options="header"]
|===
|Название колонки|Тип|Unique|Not NULL|Индекс|Описание
|id                      |bigint           |+|+|+                                                   |Идентификатор записи (первичный ключ)
|configuration_name      |varchar(255)     |-|+|-                                                   |Название конфигурации
|creation_date           |timestamp        |-|+|-                                                   |Дата создания конфигурации
|updated                 |timestamp        |-|-|-                                                   |Дата обновления конфигурации
|created_by              |varchar(255)     |-|-|-                                                   |Пользователь, который добавил конфигурацию
|build_in                |boolean          |-|-|-                                                   |Признак системной конфигурации
|active                  |boolean          |-|-|-                                                   |Признак активной конфигурации
|===

==== Таблица 3.{counter:db-table-id} - 'classifier_options' - содержит json конфигурации индивидуальных классификаторов для построения экспериментов с использованием ансамблевых алгоритмов
[cols="^20%,^14%,^8%,^8%,^8%,^30%",options="header"]
|===
|Название колонки|Тип|Unique|Not NULL|Индекс|Описание
|id                      |bigint           |+|+|+                                                   |Идентификатор записи (первичный ключ)
|options_name            |varchar(255)     |-|+|-                                                   |Название натроек
|creation_date           |timestamp        |-|+|-                                                   |Дата создания настроек
|config                  |text             |-|+|-                                                   |Json конфигурация классификатора
|config_md5_hash         |varchar(255)     |-|+|-                                                   |Md5 хеш json конфигурации
|created_by              |varchar(255)     |-|-|-                                                   |Пользователь, который добавил настройки
|configuration_id        |bigint           |-|+|fk_classifier_options_classifiers_configuration_id  |Внешний ключ classifiers_configuration
|===

==== Таблица 3.{counter:db-table-id} - 'classifiers_configuration_history' - содержит историю изменений конфигураций классификаторов
[cols="^20%,^14%,^8%,^8%,^8%,^30%",options="header"]
|===
|Название колонки|Тип|Unique|Not NULL|Индекс|Описание
|id                      |bigint           |+|+|+                                                      |Идентификатор записи (первичный ключ)
|action_type             |varchar(255)     |-|+|-                                                      |Тип события
|message_text            |text             |-|+|-                                                      |Текст сообщения
|created_at              |timestamp        |-|+|-                                                      |Дата события
|created_by              |varchar(255)     |-|+|-                                                      |Инициатор события (пользователь)
|configuration_id        |bigint           |-|+|fk_classifiers_configuration_history_configuration_id  |Внешний ключ classifiers_configuration
|===

==== Таблица 3.{counter:db-table-id} - 'message_template' - содержит шаблоны для различных сообщений
[cols="^20%,^14%,^8%,^8%,^8%,^30%",options="header"]
|===
|Название колонки|Тип|Unique|Not NULL|Индекс|Описание
|id                      |varchar(255)     |+|+|+                              |Код шаблона (первичный ключ)
|template_text           |text             |-|+|-                              |Текст шаблона
|===

==== Таблица 3.{counter:db-table-id} - 'instances_info' - содержит данные об обучающих выборках
[cols="^20%,^14%,^8%,^8%,^8%,^30%",options="header"]
|===
|Название колонки|Тип|Unique|Not NULL|Индекс|Описание
|id                      |bigint           |+|+|+                                        |Идентификатор записи (первичный ключ)
|uuid                    |varchar(255)     |+|+|instances_info_uuid_unique_idx           |Уникальный UUID выборки
|relation_name           |varchar(255)     |-|+|-                                        |Название обучающей выборки
|num_instances           |integer          |-|+|-                                        |Число объектов обучающей выборки
|num_attributes          |integer          |-|+|-                                        |Число атрибутов обучающей выборки
|num_classes             |integer          |-|+|-                                        |Число классов
|class_name              |varchar(255)     |-|+|-                                        |Название атрибута класса
|data_md5_hash           |varchar(255)     |-|+|instances_info_data_md5_hash_unique_idx  |MD5 хэш обучающей выборки
|created_date            |timestamp        |-|+|-                                        |Дата создания
|===

==== Таблица 3.{counter:db-table-id} - 'evaluation_log' - содержит данные о запросах на построение моделей классификаторов
[cols="^20%,^14%,^8%,^8%,^8%,^30%",options="header"]
|===
|Название колонки|Тип|Unique|Not NULL|Индекс|Описание
|id                         |bigint           |+|+|+                                    |Идентификатор записи (первичный ключ)
|request_id                 |varchar(255)     |+|+|evaluation_log_request_id_unique_idx |Уникальный UUID запроса
|training_data_uuid         |varchar(255)     |-|-|-                                    |UUID обучающей выборки из единого хранилища обучающих выборок
|channel_type               |varchar(255)     |-|+|-                                    |Канал поступления заявки (QUEUE или WEB)
|created_by                 |varchar(255)     |-|-|-                                    |Пользователь, создавший заявку через WEB
|creation_date              |timestamp        |-|+|-                                    |Дата создания запроса
|start_date                 |timestamp        |-|-|-                                    |Дата начала построения модели
|end_date                   |timestamp        |-|-|-                                    |Дата завершения построения модели
|request_status             |varchar(255)     |-|+|-                                    |Статус запроса
|evaluation_method          |varchar(255)     |-|+|-                                    |Метод оценки точности
|num_folds                  |integer          |-|-|-                                    |Число блоков для k * V - блочной кросс проверки на тестовой выборке
|num_tests                  |integer          |-|-|-                                    |Число тестов для k * V - блочной кросс проверки на тестовой выборке
|seed                       |integer          |-|-|-                                    |Начальное значение (seed) для генератор псевдослучайных чисел
|instances_info_id          |bigint           |-|+|+                                    |Внешний ключ, ID обучающей выборки
|classifier_info_id         |bigint           |-|+|+                                    |Внешний ключ, ID информации о классификаторе
|error_message              |text             |-|-|-                                    |Текст ошибки
|model_path                 |varchar(255)     |-|-|-                                    |Путь к объекту в S3 с моделью классификатора
|deleted_date               |timestamp        |-|-|-                                    |Дата удаления модели классификатора
|pct_correct                |numeric(19,4)    |-|-|-                                    |Точность классификатора
|===

==== Таблица 3.{counter:db-table-id} - 'experiment' - содержит данные о заявках на построение экспрериментов
[cols="^20%,^14%,^8%,^8%,^8%,^30%",options="header"]
|===
|Название колонки|Тип|Unique|Not NULL|Индекс|Описание
|id                           |bigint           |+|+|+                                 |Идентификатор записи (первичный ключ)
|request_id                   |varchar(255)     |+|+|+                                 |Уникальный UUID заявки
|creation_date                |timestamp        |-|+|-                                 |Дата создания заявки
|start_date                   |timestamp        |-|-|-                                 |Дата начала построения эксперимента
|end_date                     |timestamp        |-|-|-                                 |Дата завершения построения эксперимента
|request_status               |varchar(255)     |-|+|-                                 |Статус заявки
|evaluation_method            |varchar(255)     |-|+|-                                 |Метод оценки точности
|num_folds                    |integer          |-|-|-                                 |Число блоков для k * V - блочной кросс проверки на тестовой выборке
|num_tests                    |integer          |-|-|-                                 |Число тестов для k * V - блочной кросс проверки на тестовой выборке
|seed                         |integer          |-|-|-                                 |Начальное значение (seed) для генератор псевдослучайных чисел
|experiment_type              |varchar(255)     |-|+|-                                 |Тип эксперимента
|email                        |varchar(255)     |-|-|-                                 |Email пользователя для отправки результатов эксперимента
|training_data_uuid           |varchar(255)     |-|-|-                                 |UUID обучающей выборки из единого хранилища обучающих выборок
|model_path                   |varchar(255)     |-|-|-                                 |Путь к объекту в S3 с результатами эксперимента
|error_message                |text             |-|-|-                                 |Текст ошибки
|deleted_date                 |timestamp        |-|-|-                                 |Дата удаления файлов с результатами эксперимента
|experiment_download_url      |varchar(1024)    |-|-|-                                 |Ссылка для скачивания результатов эксперимента из S3
|channel_type                 |varchar(255)     |-|+|-                                 |Канал поступления заявки (QUEUE или WEB)
|reply_to                     |varchar(255)     |-|-|-                                 |Название очереди для отправки ответных сообщений в MQ
|correlation_id               |varchar(255)     |-|-|-                                 |Значение для корреляции запрос/ответ
|instances_info_id            |bigint           |-|+|+                                 |Внешний ключ, ID обучающей выборки
|created_by                   |varchar(255)     |-|-|-                                 |Пользователь, создавший заявку через WEB
|max_pct_correct              |numeric(19,4)    |-|-|-                                 |Точность наилучшего классификатора из истории эксперимента
|===

==== Таблица 3.{counter:db-table-id} - 'experiment_progress' - содержит данные о статусах построения экспериментов
[cols="^20%,^14%,^8%,^8%,^8%,^30%",options="header"]
|===
|Название колонки|Тип|Unique|Not NULL|Индекс|Описание
|id                           |bigint           |+|+|+                                     |Идентификатор записи (первичный ключ)
|progress                     |integer          |-|+|-                                     |Значение прогресс бара в %
|finished                     |boolean          |-|-|-                                     |Флаг завершения построения эксперимента
|experiment_id                |bigint           |-|+|fk_experiment_progress_experiment_id  |Внешний ключ, ID эксперимента
|===

==== Таблица 3.{counter:db-table-id} - 'experiment_step' - содержит данные о шагах построения экспериментов
[cols="^20%,^14%,^8%,^8%,^8%,^30%",options="header"]
|===
|Название колонки|Тип|Unique|Not NULL|Индекс|Описание
|id                           |bigint           |+|+|+                                     |Идентификатор записи (первичный ключ)
|step                         |varchar(255)     |-|+|-                                     |Название шага (EXPERIMENT_PROCESSING, UPLOAD_EXPERIMENT_MODEL, GET_EXPERIMENT_DOWNLOAD_URL, CREATE_ERS_REPORT)
|status                       |varchar(255)     |-|+|-                                     |Статус выполнения шага (READY, COMPLETED, FAILED, CANCELED, TIMEOUT, ERROR)
|step_order                   |integer          |-|+|-                                     |Порядок выполнения шага
|created                      |timestamp        |-|+|-                                     |Дата создания шага
|started                      |timestamp        |-|-|-                                     |Дата последнего запуска шага
|completed                    |timestamp        |-|-|-                                     |Дата завершения выполнения шага
|error_message                |text             |-|-|-                                     |Текст ошибки
|num_failed_attempts          |integer          |-|-|-                                     |Число неудачных попыток выполнения шага
|experiment_id                |bigint           |-|+|fk_experiment_step_experiment_id      |Внешний ключ, ID эксперимента
|===

Таблица также содержит уникальный составной индекс *add_experiment_step_experiment_id_step_unique_idx* на поля (experiment_id, step)
Таблица также содержит уникальный составной индекс *add_experiment_step_experiment_id_step_order_unique_idx* на поля (experiment_id, step_order)

==== Таблица 3.{counter:db-table-id} - 'experiment_results' - содержит мета данные о результатах экспериментов
[cols="^20%,^14%,^8%,^8%,^8%,^30%",options="header"]
|===
|Название колонки|Тип|Unique|Not NULL|Индекс|Описание
|id                           |bigint           |+|+|+                                         |Идентификатор записи (первичный ключ)
|results_index                |integer          |-|+|-                                         |Индекс результатов классификации в истории экспериментов
|classifier_info_id           |bigint           |-|+|fk_experiment_results_classifier_info_id  |Внешний ключ, ID информации о классификаторе
|experiment_id                |bigint           |-|+|fk_experiment_results_experiment_id       |Внешний ключ, ID эксперимента
|pct_correct                  |numeric(19,4)    |-|+|-                                         |Точность классификатора
|===

==== Таблица 3.{counter:db-table-id} - 'ers_request' - системная таблица для интеграции с сервисом eca-ers
[cols="^20%,^14%,^8%,^8%,^8%,^30%",options="header"]
|===
|Название колонки|Тип|Unique|Not NULL|Индекс|Описание
|id                           |bigint           |+|+|+                         |Идентификатор записи (первичный ключ)
|request_date                 |timestamp        |-|-|-                         |Дата запроса
|request_id                   |varchar(255)     |+|+|ers_request_id_unique_idx |Уникальный UUID запроса
|response_status              |varchar(255)     |-|+|-                         |Статус ответа от eca-ers
|details                      |text             |-|-|-                         |Детальная информация об ошибке
|===

==== Таблица 3.{counter:db-table-id} - 'evaluation_results_request' - данные запросов в eca-ers для сохранения результатов классификации
[cols="^20%,^14%,^8%,^8%,^8%,^30%",options="header"]
|===
|Название колонки|Тип|Unique|Not NULL|Индекс|Описание
|id                           |bigint           |+|+|fk_evaluation_results_id                                 |Идентификатор записи (первичный ключ) и внешний ключ на ers_request
|evaluation_log_id            |bigint           |+|+|fk_evaluation_log, evaluation_log_request_id_unique_idx  |Внешний ключ, ID evaluation_log
|===

==== Таблица 3.{counter:db-table-id} - 'experiment_results_request' - данные запросов в eca-ers для сохранения результатов экспериментов
[cols="^20%,^14%,^8%,^8%,^8%,^30%",options="header"]
|===
|Название колонки|Тип|Unique|Not NULL|Индекс|Описание
|id                           |bigint           |+|+|fk_experiment_results_id                                                                                           |Идентификатор записи (первичный ключ) и внешний ключ на ers_request
|experiment_results_id        |bigint           |+|+|fk_experiment_results_request_experiment_results_id, experiment_results_request_experiment_results_id_unique_idx   |Внешний ключ, ID experiment_results                                                                                                               |Источник запроса
|===

==== Таблица 3.{counter:db-table-id} - 'classifier_options_request_model' - содержит информацию о запросах в eca-ers на нахождение оптимальных настроек классификаторов
[cols="^20%,^14%,^8%,^8%,^8%,^30%",options="header"]
|===
|Название колонки|Тип|Unique|Not NULL|Индекс|Описание
|id                                  |bigint           |+|+|fk_classifier_options_request_id                         |Идентификатор записи (первичный ключ) и внешний ключ на ers_request
|instances_info_id                   |bigint           |-|+|fk_classifier_options_request_model_instances_info_id    |Внешний ключ, ID обучающей выборки
|evaluation_method                   |varchar(255)     |-|-|-                                                        |Метод оценки точности
|num_folds                           |integer          |-|-|-                                                        |Число блоков для k * V - блочной кросс проверки на тестовой выборке
|num_tests                           |integer          |-|-|-                                                        |Число тестов для k * V - блочной кросс проверки на тестовой выборке
|seed                                |integer          |-|-|-                                                        |Начальное значение (seed) для генератор псевдослучайных чисел
|===

==== Таблица 3.{counter:db-table-id} - 'classifier_options_response_model' - содержит информацию об оптимальных настройках классификаторов от eca-ers
[cols="^20%,^14%,^8%,^8%,^8%,^30%",options="header"]
|===
|Название колонки|Тип|Unique|Not NULL|Индекс|Описание
|id                                  |bigint           |+|+|+                                        |Идентификатор записи (первичный ключ)
|classifier_name                     |varchar(255)     |-|-|-                                        |Название классификатора
|classifier_description              |varchar(255)     |-|-|-                                        |Описание классификатора
|classifier_options                  |text             |-|-|-                                        |Настройки классификатора
|classifier_options_request_model_id |bigint           |-|+|fk_classifier_options_request_model_id   |Внешний ключ, ID запроса classifier_options_request_model
|===

==== Таблица 3.{counter:db-table-id} - 'classifier_options_request' - содержит информацию о запросах на нахождение оптимальных настроек классификаторов
[cols="^20%,^14%,^8%,^8%,^8%,^30%",options="header"]
|===
|Название колонки|Тип|Unique|Not NULL|Индекс|Описание
|id                                  |bigint           |+|+|fk_classifier_options_request_id                   |Идентификатор записи (первичный ключ)
|request_id                          |varchar(255)     |+|+|classifier_options_request_request_id_unique_idx   |Уникальный UUID запроса
|creation_date                       |timestamp        |-|-|-                                                  |Дата запроса
|source                              |varchar(255)     |-|-|-                                                  |Тип источника данных (CACHE или ERS)
|classifier_options_request_model_id |bigint           |-|+|fk_options_request_model_id                        |Внешний ключ, ID classifier_options_request_model
|===

Таблицы *databasechangeloglock* и *databasechangeloglock* предназначены для управления миграциями базы данных.

=== 3.3 Схема БД eca-oauth

На рисунке 3.2 приведена схема базы данных eca-oauth:

image::./images/eca-oauth-db-schema.png[alt=Схема базы данных eca-oauth,scaledwidth=80%]

=== 3.4 Описание БД eca-oauth

==== Таблица 3.{counter:db-table-id} - 'user_entity' - содержит данные о пользователях
[cols="^20%,^14%,^8%,^8%,^8%,^30%",options="header"]
|===
|Название колонки|Тип|Unique|Not NULL|Индекс|Описание
|id                      |bigint           |+|+|+                              |Идентификатор записи (первичный ключ)
|creation_date           |timestamp        |-|+|-                              |Дата создания пользователя
|login                   |varchar(255)     |+|+|login_unique_index             |Логин пользователя
|password                |varchar(255)     |-|+|-                              |Хеш пароля пользователя
|email                   |varchar(255)     |+|+|email_unique_index             |Email пользователя
|first_name              |varchar(255)     |-|+|-                              |Имя пользователя
|last_name               |varchar(255)     |-|+|-                              |Фамилия пользователя
|middle_name             |varchar(255)     |-|+|-                              |Отчество пользователя
|photo_id                |bigint           |-|-|fk_user_photo_id               |Внешний ключ фото пользователя
|tfa_enabled             |boolean          |-|-|-                              |Вкл./выкл. двухфакторную аутентификацию
|locked                  |boolean          |-|-|-                              |Вкл./выкл. блокировку пользователя
|password_change_date    |timestamp        |-|-|-                              |Дата последнего изменения пароля
|force_change_password   |boolean          |-|-|-                              |Флаг принудительной смены временного пароля
|===

==== Таблица 3.{counter:db-table-id} - 'role_entity' - содержит данные о ролях
[cols="^20%,^14%,^8%,^8%,^8%,^30%",options="header"]
|===
|Название колонки|Тип|Unique|Not NULL|Индекс|Описание
|id                      |bigint           |+|+|+                              |Идентификатор записи (первичный ключ)
|role_name               |varchar(255)     |+|+|role_name_unique_index         |Технический код роли
|description             |varchar(255)     |-|-|-                              |Описание роли
|===

==== Таблица 3.{counter:db-table-id} - 'user_role' - содержит данные о соответствиях пользователи - роли
[cols="^20%,^14%,^8%,^8%,^8%,^30%",options="header"]
|===
|Название колонки|Тип|Unique|Not NULL|Индекс|Описание
|user_id                      |bigint           |-|+|fk_user_role_user_id      |Внешний ключ пользователя
|role_id                      |bigint           |-|+|fk_user_role_role_id      |Внешний ключ роли
|===

Таблица также содержит составной первичный ключ для полей user_id, role_id

==== Таблица 3.{counter:db-table-id} - 'user_photo' - содержит данные о фотографиях пользователей
[cols="^20%,^14%,^8%,^8%,^8%,^30%",options="header"]
|===
|Название колонки|Тип|Unique|Not NULL|Индекс|Описание
|id                      |bigint           |+|+|+                              |Идентификатор записи (первичный ключ)
|file_name               |varchar(255)     |-|-|-                              |Название файла с фотографией
|file_extension          |varchar(255)     |-|-|-                              |Расширение файла
|photo                   |bytea            |-|-|-                              |Фотография в двоичном виде
|===

==== Таблица 3.{counter:db-table-id} - 'user_profile_options' - содержит данные о настройказ профилей пользователей
[cols="^20%,^14%,^8%,^8%,^8%,^30%",options="header"]
|===
|Название колонки|Тип|Unique|Not NULL|Индекс|Описание
|id                      |bigint           |+|+|+                                |Идентификатор записи (первичный ключ)
|email_enabled           |boolean          |-|-|-                                |Вкл./выкл. уведомлений по email
|web_push_enabled        |boolean          |-|-|-                                |Вкл./выкл. пуш уведомлений
|created                 |timestamp        |-|+|-                                |Дата создания
|user_id                 |bigint           |-|+|fk_user_profile_options_user_id  |Внешний ключ пользователя
|version                 |integer          |-|+|-                                |Версия настроек
|===

==== Таблица 3.{counter:db-table-id} - 'user_profile_options_data_event' - содержит данные для отправки событий изменения настроек профиля пользователя
[cols="^20%,^14%,^8%,^8%,^8%,^30%",options="header"]
|===
|Название колонки|Тип|Unique|Not NULL|Индекс|Описание
|id                      |bigint           |+|+|+                                |Идентификатор записи (первичный ключ)
|request_id              |varchar(255)     |-|+|-                                |UUID события
|message_body            |varchar(2048)    |-|+|-                                |Сообщение для отправки
|created                 |timestamp        |-|+|-                                |Дата создания
|===

Таблица также содержит уникальный индекс *user_profile_options_user_id_unique_idx* на поле user_id

==== Таблица 3.{counter:db-table-id} - 'user_notification_event_options' - содержит данные о настройказ профилей пользователей
[cols="^20%,^14%,^8%,^8%,^8%,^30%",options="header"]
|===
|Название колонки|Тип|Unique|Not NULL|Индекс|Описание
|id                      |bigint           |+|+|+                                                           |Идентификатор записи (первичный ключ)
|event_type              |varchar(255)     |-|+|-                                                           |Тип события
|email_enabled           |boolean          |-|-|-                                                           |Вкл./выкл. уведомлений по email
|web_push_enabled        |boolean          |-|-|-                                                           |Вкл./выкл. пуш уведомлений
|email_supported         |boolean          |-|-|-                                                           |Вкл./выкл. поддержка уведомлений по email
|web_push_supported      |boolean          |-|-|-                                                           |Вкл./выкл. поддержка пуш уведомлений
|user_profile_options_id |bigint           |-|+|fk_user_notification_event_options_user_profile_options_id  |Внешний ключ user_profile_options
|===

Таблица также содержит уникальный индекс *user_profile_options_id_event_type_unique_idx* на поля user_profile_options_id, event_type

==== Таблица 3.{counter:db-table-id} - 'reset_password_request' - содержит данные о запросах на восстановление пароля
[cols="^20%,^14%,^8%,^8%,^8%,^30%",options="header"]
|===
|Название колонки|Тип|Unique|Not NULL|Индекс|Описание
|id                      |bigint           |+|+|+                                          |Идентификатор записи (первичный ключ)
|token                   |varchar(255)     |+|+|reset_password_request_token_unique_index  |Короткоживущий токен для восстановления пароля
|expire_date             |timestamp        |-|+|-                                          |Дата истечения срока действия токена
|reset_date              |timestamp        |-|-|-                                          |Дата восстановления пароля
|user_id                 |bigint           |-|+|fk_reset_password_request_user_id          |Внешний ключ пользователя
|created                 |timestamp        |-|+|-                                          |Дата создания записи
|===

==== Таблица 3.{counter:db-table-id} - 'change_password_request' - содержит данные о запросах на смену пароля
[cols="^20%,^14%,^8%,^8%,^8%,^30%",options="header"]
|===
|Название колонки|Тип|Unique|Not NULL|Индекс|Описание
|id                      |bigint           |+|+|+                                          |Идентификатор записи (первичный ключ)
|token                   |varchar(255)     |+|+|change_password_request_token_unique_index |Короткоживущий токен для смены пароля
|confirmation_code       |varchar(255)     |-|+|-                                          |Код подтверждения из письма для смены пароля
|expire_date             |timestamp        |-|+|-                                          |Дата истечения срока действия токена
|confirmation_date       |timestamp        |-|-|-                                          |Дата подтверждения смены пароля
|new_password            |varchar(255)     |-|+|-                                          |Хеш пароля для изменения
|user_id                 |bigint           |-|+|fk_change_password_request_user_id         |Внешний ключ пользователя
|created                 |timestamp        |-|+|-                                          |Дата создания записи
|===

==== Таблица 3.{counter:db-table-id} - 'change_email_request' - содержит данные о запросах на изменение Email
[cols="^20%,^14%,^8%,^8%,^8%,^30%",options="header"]
|===
|Название колонки|Тип|Unique|Not NULL|Индекс|Описание
|id                      |bigint           |+|+|+                                          |Идентификатор записи (первичный ключ)
|token                   |varchar(255)     |+|+|change_email_request_token_unique_index    |Короткоживущий токен для изменения Email
|expire_date             |timestamp        |-|+|-                                          |Дата истечения срока действия токена
|confirmation_code       |varchar(255)     |-|+|-                                          |Код подтверждения из письма для смены email
|confirmation_date       |timestamp        |-|-|-                                          |Дата подтверждения изменения Email
|new_email               |varchar(255)     |-|+|-                                          |Новый Email
|user_id                 |bigint           |-|+|fk_change_email_request_user_id            |Внешний ключ пользователя
|created                 |timestamp        |-|+|-                                          |Дата создания записи
|===

==== Таблица 3.{counter:db-table-id} - 'tfa_code' - содержит данные кодов подтверждения для 2FA
[cols="^20%,^14%,^8%,^8%,^8%,^30%",options="header"]
|===
|Название колонки|Тип|Unique|Not NULL|Индекс|Описание
|id                      |bigint           |+|+|+                                          |Идентификатор записи (первичный ключ)
|token                   |varchar(255)     |+|+|tfa_code_token_unique_index                |Короткоживущий токен для выполнения tfa
|code                    |varchar(255)     |-|+|-                                          |Код подтверждения 2fa
|registered_client_id    |varchar(255)     |-|+|-                                          |Идентификатор клиента
|expire_date             |timestamp        |-|+|-                                          |Дата истечения срока действия кода
|authentication          |text             |-|+|-                                          |Сериализованный объект Authentication
|user_id                 |bigint           |-|+|fk_tfa_code_user_id                        |Внешний ключ пользователя
|created                 |timestamp        |-|+|-                                          |Дата создания записи
|===

Таблицы *databasechangeloglock* и *databasechangeloglock* предназначены для управления миграциями базы данных.
Таблицы с префиксом oauth2_ предназначены для работы с библиотекой spring security oauth2.

=== 3.5 Схема БД eca-ers

На рисунке 3.3 приведена схема базы данных eca-ers:

image::./images/eca-ers-db-schema.png[alt=Схема базы данных eca-ers,scaledwidth=80%]

=== 3.6 Описание таблиц БД eca-ers

==== Таблица 3.{counter:db-table-id} - 'instances_info' - содержит данные об обучающих выборках
[cols="^20%,^14%,^8%,^8%,^8%,^30%",options="header"]
|===
|Название колонки|Тип|Unique|Not NULL|Индекс|Описание
|id                      |bigint           |+|+|+                                           |Идентификатор записи (первичный ключ)
|data_md5_hash           |varchar(255)     |-|+|instances_info_data_md5_hash_unique_idx     |MD5 хеш данных
|relation_name           |varchar(255)     |-|+|-                                           |Название обучающей выборки
|num_instances           |integer          |-|+|-                                           |Число объектов обучающей выборки
|num_attributes          |integer          |-|+|-                                           |Число атрибутов обучающей выборки
|num_classes             |integer          |-|+|-                                           |Число классов
|class_name              |varchar(255)     |-|+|-                                           |Название атрибута класса
|created_date            |timestamp        |-|+|-                                            |Дата создания
|===

==== Таблица 3.{counter:db-table-id} - 'classifier_options_info' - содержит данные о классификаторах
[cols="^20%,^14%,^8%,^8%,^8%,^30%",options="header"]
|===
|Название колонки|Тип|Unique|Not NULL|Индекс|Описание
|id                      |bigint           |+|+|+                       |Идентификатор записи (первичный ключ)
|classifier_name         |varchar(255)     |-|+|-                       |Название классификатора
|classifier_description  |varchar(255)     |-|-|-                       |Описание классификатора
|options                 |text             |-|+|-                       |Настройки классификатора
|===

==== Таблица 3.{counter:db-table-id} - 'evaluation_results_info' - содержит мета информацию о результатах классификации
[cols="^20%,^14%,^8%,^8%,^8%,^30%",options="header"]
|===
|Название колонки|Тип|Unique|Not NULL|Индекс|Описание
|id                               |bigint           |+|+|+                                              |Идентификатор записи (первичный ключ)
|evaluation_method                |varchar(255)     |-|+|-                                              |Метод оценки точности
|num_folds                        |integer          |-|-|-                                              |Число блоков для k * V - блочной кросс проверки на тестовой выборке
|num_tests                        |integer          |-|-|-                                              |Число тестов для k * V - блочной кросс проверки на тестовой выборке
|seed                             |integer          |-|-|-                                              |Начальное значение (seed) для генератор псевдослучайных чисел
|request_id                       |varchar(255)     |+|+|evaluation_results_info_request_id_unique_idx  |Уникальный UUID запроса
|save_date                        |timestamp        |-|+|-                                              |Дата сохранения результатов
|instances_info_id                |bigint           |-|+|+                                              |Внешний ключ данных об обучающей выборке
|classifier_options_info_id       |bigint           |-|+|+                                              |Внешний ключ данных о классификаторе
|num_test_instances               |integer          |-|-|-                                              |Число объектов тестовых данных
|num_correct                      |integer          |-|-|-                                              |Число верно классифицированных объектов
|num_incorrect                    |integer          |-|-|-                                              |Число неверно классифицированных объектов
|pct_correct                      |numeric(19,4)    |-|-|-                                              |Доля верно классифицированных объектов
|pct_incorrect                    |numeric(19,4)    |-|-|-                                              |Доля неверно классифицированных объектов
|mean_abs_error                   |numeric(19,4)    |-|-|-                                              |Средняя абсолютная ошибка классификации
|root_mean_squared_error          |numeric(19,4)    |-|-|-                                              |Среднеквадратическая ошибка классификации
|max_auc                          |numeric(19,4)    |-|-|-                                              |Максимальное значение показателя AUC среди всех классов
|variance_error                   |numeric(19,4)    |-|-|-                                              |Дисперсия ошибки классификатора
|confidence_interval_lower_bound  |numeric(19,4)    |-|-|-                                              |Нижняя граница 95% доверительного интервала ошибки классификатора
|confidence_interval_upper_bound  |numeric(19,4)    |-|-|-                                              |Верхняя граница 95% доверительного интервала ошибки классификатора
|===

==== Таблица 3.{counter:db-table-id} - 'classification_costs_info' - содержит данные о результатах классификации
[cols="^20%,^14%,^8%,^8%,^8%,^30%",options="header"]
|===
|Название колонки|Тип|Unique|Not NULL|Индекс|Описание
|id                               |bigint           |+|+|+                       |Идентификатор записи (первичный ключ)
|class_index                      |integer          |-|+|-                       |Индекс класса
|class_value                      |varchar(255)     |-|+|-                       |Название класса
|fn_rate                          |numeric(19,4)    |-|-|-                       |Доля положительных примеров, классифицированных как отрицательные
|fp_rate                          |numeric(19,4)    |-|-|-                       |Доля отрицательных примеров, классифицированных как положительные
|tn_rate                          |numeric(19,4)    |-|-|-                       |Доля верно классифицированных отрицательных примеров
|tp_rate                          |numeric(19,4)    |-|-|-                       |Доля верно классифицированных положительных примеров для данного класса
|auc_value                        |numeric(19,4)    |-|-|-                       |Значение площади под ROC - кривой для соответствующего класса
|specificity                      |numeric(19,4)    |-|-|-                       |Значение специфичности оптимальной точки ROC - кривой для соответствующего класса
|sensitivity                      |numeric(19,4)    |-|-|-                       |Значение чувствительности оптимальной точки ROC - кривой для соответствующего класса
|threshold_value                  |numeric(19,4)    |-|-|-                       |Значения оптимальный порога для определения класса
|evaluation_results_info_id       |bigint           |-|+|+                       |Внешний ключ evaluation_results_info
|===

==== Таблица 3.{counter:db-table-id} - 'confusion_matrix' - матрица классификации
[cols="^20%,^14%,^8%,^8%,^8%,^30%",options="header"]
|===
|Название колонки|Тип|Unique|Not NULL|Индекс|Описание
|id                               |bigint           |+|+|+                       |Идентификатор записи (первичный ключ)
|actual_class_index               |integer          |-|+|-                       |Реальный индекс класса
|predicted_class_index            |integer          |-|+|-                       |Прогнозный индекс класса
|num_instances                    |integer          |-|+|-                       |Число объектов
|evaluation_results_info_id       |bigint           |-|+|+                       |Внешний ключ evaluation_results_info
|===

==== Таблица 3.{counter:db-table-id} - 'evaluation_results_sort' - таблица конфигурации сортировки результатов классификации
[cols="^20%,^14%,^8%,^8%,^8%,^30%",options="header"]
|===
|Название колонки|Тип|Unique|Not NULL|Индекс|Описание
|id                               |bigint           |+|+|+                                       |Идентификатор записи (первичный ключ)
|field_name                       |varchar(255)     |-|+|field_name_field_order_unique_index     |Название поля
|is_ascending                     |boolean          |-|-|-                                       |Сортировка по возрастанию?
|field_order                      |integer          |-|+|field_name_field_order_unique_index     |Порядок поля для сортировки
|===

Таблица содержит уникальный индекс на поля field_name, field_order.

Таблицы *databasechangeloglock* и *databasechangeloglock* предназначены для управления миграциями базы данных.

=== 3.7 Схема БД eca-data-storage

На рисунке 3.4 приведена схема базы данных eca-data -storage:

image::./images/eca-data-storage-db-schema.png[alt=Схема базы данных eca-data-storage,scaledwidth=80%]

=== 3.8 Описание таблиц БД eca-data-storage

==== Таблица 3.{counter:db-table-id} - 'instances' - данные о таблицах с обучающими выборками
[cols="^20%,^14%,^8%,^8%,^8%,^30%",options="header"]
|===
|Название колонки|Тип|Unique|Not NULL|Индекс|Описание
|id                      |bigint           |+|+|+                                      |Идентификатор записи (первичный ключ)
|uuid                    |varchar(255)     |+|+|instances_uuid_unique_idx              |UUID обучающей выборки
|relation_name           |varchar(255)     |+|+|instances_relation_name_unique_idx     |Название данных
|table_name              |varchar(255)     |+|+|table_name_unique_index                |Название таблицы с данными
|id_column_name          |varchar(255)     |-|+|-                                      |Название колонки с primary key в таблице с данными
|num_instances           |integer          |-|-|-                                      |Число объектов обучающей выборки
|num_attributes          |integer          |-|-|-                                      |Число атрибутов обучающей выборки
|creation_date           |timestamp        |-|+|-                                      |Дата создания записи
|created_by              |varchar(255)     |-|+|-                                      |Пользователь, который добавил обучающую выборку
|class_attribute_id      |bigint           |-|-|fk_instances_class_attribute_id        |ID атрибута класса
|updates_counter         |integer          |-|-|-                                      |Счетчик изменений таблицы с данными
|===

==== Таблица 3.{counter:db-table-id} - 'attribute' - данные об атрибутах обучающей выборки
[cols="^20%,^14%,^8%,^8%,^8%,^30%",options="header"]
|===
|Название колонки|Тип|Unique|Not NULL|Индекс|Описание
|id                      |bigint           |+|+|+                                |Идентификатор записи (первичный ключ)
|attribute_name          |varchar(255)     |-|+|+                                |Название атрибута
|column_name             |varchar(255)     |-|+|+                                |Название атрибута (столбца) в таблице с данными
|_type                   |varchar(255)     |-|+|-                                |Ти атрибута (NUMERIC, NOMINAL, DATE)
|selected                |boolean          |-|-|-                                |Флаг выбора атрибута для классификации
|_index                  |integer          |-|+|+                                |Порядковый номер атрибута
|instances_id            |bigint           |-|+|fk_attribute_instances_id        |ID обучающей выборки                 |
|===

Таблица содержит уникальный индекс instances_id_index_unique_index на поля instances_id, _index.

Таблица содержит уникальный индекс instances_id_column_name_unique_index на поля instances_id, column_name.

==== Таблица 3.{counter:db-table-id} - 'attribute_value' - данные о значениях атрибутов
[cols="^20%,^14%,^8%,^8%,^8%,^30%",options="header"]
|===
|Название колонки|Тип|Unique|Not NULL|Индекс|Описание
|id                      |bigint           |+|+|+                                |Идентификатор записи (первичный ключ)
|_value                  |varchar(255)     |-|+|+                                |Значение
|_index                  |integer          |-|+|+                                |Целочисленный код значения (порядковый номер)
|attribute_id            |bigint           |-|+|fk_attribute_value_attribute_id  |ID атрибута            |
|===

Таблица содержит уникальный индекс attribute_id_value_unique_index на поля attribute_id, _value.

Таблица содержит уникальный индекс attribute_id_index_unique_index на поля attribute_id, _index.

==== Таблица 3.{counter:db-table-id} - 'export_instances_object' - данные о таблицах с обучающими выборками
[cols="^20%,^14%,^8%,^8%,^8%,^30%",options="header"]
|===
|Название колонки|Тип|Unique|Not NULL|Индекс|Описание
|id                      |bigint           |+|+|+                                      |Идентификатор записи (первичный ключ)
|instances_uuid          |varchar(255)     |+|+|-                                      |UUID таблицы с данными
|external_data_uuid      |varchar(255)     |+|+|-                                      |UUID обучающей выборки из единого хранлища данных
|md5_hash                |varchar(255)     |+|+|-                                      |MD5 hash обучающей выборки
|expire_at               |timestamp        |-|+|-                                           |Дата истечения срока действия объекта обучающей выборки
|creation_date           |timestamp        |-|+|-                                      |Дата создания записи
|updates_counter         |integer          |-|-|-                                      |Счетчик изменений таблицы с данными на момент выгрузки
|===

Таблицы *databasechangeloglock* и *databasechangeloglock* предназначены для управления миграциями базы данных.

=== 3.9 Схема БД eca-mail

На рисунке 3.5 приведена схема базы данных eca-mail:

image::./images/eca-mail-db-schema.png[alt=Схема базы данных eca-mail,scaledwidth=80%]

=== 3.10 Описание таблиц БД eca-mail

==== Таблица 3.{counter:db-table-id} - 'email' - содержит данные о запросах на отправку email
[cols="^20%,^14%,^8%,^8%,^8%,^30%",options="header"]
|===
|Название колонки|Тип|Unique|Not NULL|Индекс|Описание
|id                      |bigint           |+|+|+                       |Идентификатор записи (первичный ключ)
|uuid                    |varchar(255)     |+|+|email_uuid_unique_idx   |Уникальный UUID запроса
|sender                  |varchar(255)     |-|+|-                       |Адрес отправителя
|receiver                |varchar(255)     |-|+|-                       |Адрес получателя
|subject                 |varchar(255)     |-|+|-                       |Тема письма
|message                 |text             |-|+|-                       |Тело сообщения
|save_date               |timestamp        |-|+|-                       |Дата создания запроса
|sent_date               |timestamp        |-|-|-                       |Дата отправки письма
|status                  |varchar(255)     |-|+|-                       |Статус отправки письма
|error_message           |text             |-|-|-                       |Текст ошибки при отправке письма
|failed_attempts_to_sent |integer          |-|-|-                       |Число попыток отправки письма
|tx_id                   |varchar(255)     |-|-|-                       |Идентификатор для кросс-системного логирования
|priority                |integer          |-|+|-                       |Приоритет доставки
|===

==== Таблица 3.{counter:db-table-id} - 'regex' - содержит данные о регулярных выражениях для переменных шаблонов
[cols="^20%,^14%,^8%,^8%,^8%,^30%",options="header"]
|===
|Название колонки|Тип|Unique|Not NULL|Индекс|Описание
|id                      |bigint           |+|+|+                       |Идентификатор записи (первичный ключ)
|created                 |timestamp        |-|+|-                       |Дата создания записи
|regex_code              |varchar(255)     |+|+|regex_code_unique_idx   |Технический код регулярного выражения
|regex                   |varchar(255)     |-|+|-                       |Строка регулярного выражения
|description             |varchar(255)     |-|+|-                       |Описание регулярного выражения
|===

==== Таблица 3.{counter:db-table-id} - 'template' - содержит данные о шаблонах email - ообщений
[cols="^20%,^14%,^8%,^8%,^8%,^30%",options="header"]
|===
|Название колонки|Тип|Unique|Not NULL|Индекс|Описание
|id                      |bigint           |+|+|+                        |Идентификатор записи (первичный ключ)
|created                 |timestamp        |-|+|-                        |Дата создания записи
|template_code           |varchar(255)     |+|+|template_code_unique_idx |Технический код шаблона
|description             |varchar(255)     |-|+|-                        |Описание шаблона
|template_subject        |varchar(255)     |-|+|-                        |Тема шаблона
|template_body           |varchar(255)     |-|-|-                        |Текст шаблона
|===

==== Таблица 3.{counter:db-table-id} - 'template_parameter' - содержит данные о параметрах шаблонов email - ообщений
[cols="^20%,^14%,^8%,^8%,^8%,^30%",options="header"]
|===
|Название колонки|Тип|Unique|Not NULL|Индекс|Описание
|id                      |bigint           |+|+|+                              |Идентификатор записи (первичный ключ)
|created                 |timestamp        |-|+|-                              |Дата создания записи
|parameter_name          |varchar(255)     |+|+|parameter_name_unique_idx      |Название переменной шаблона
|description             |varchar(255)     |-|+|-                              |Описание переменной шаблона
|regex_id                |bigint           |-|-|fk_template_parameter_regex_id |Внешний ключ регулярного выражения
|===

==== Таблица 3.{counter:db-table-id} - 'templates_parameters' - таблица соответствий для шаблонов и параметров
[cols="^20%,^14%,^8%,^8%,^8%,^30%",options="header"]
|===
|Название колонки|Тип|Unique|Not NULL|Индекс|Описание
|template_id                      |bigint           |-|+|fk_templates_parameters_template_id  |Внешний ключ шаблона
|parameter_id                     |bigint           |-|+|fk_templates_parameters_param_id     |Внешний ключ параметра шаблона
|===

Таблица также содержит составной первичный ключ для полей template_id, param_id.

Таблицы *databasechangeloglock* и *databasechangeloglock* предназначены для управления миграциями базы данных.

=== 3.11 Схема БД eca-audit-log

На рисунке 3.6 приведена схема базы данных eca-audit-log:

image::./images/eca-audit-log-db-schema.png[alt=Схема базы данных eca-audit-log,scaledwidth=80%]

=== 3.12 Описание таблиц БД eca-audit-log

==== Таблица 3.{counter:db-table-id} - 'audit_log' - содержит данные о событиях аудита в системе
[cols="^20%,^14%,^8%,^8%,^8%,^30%",options="header"]
|===
|Название колонки|Тип|Unique|Not NULL|Индекс|Описание
|id                      |bigint           |+|+|+                              |Идентификатор записи (первичный ключ)
|event_id                |varchar(255)     |+|+|audit_log_event_id_unique_idx  |Внешний ID события
|message                 |text             |-|+|-                              |Текст сообщения
|initiator               |varchar(255)     |-|+|-                              |Источник события, например имя пользователя
|event_type              |varchar(255)     |-|+|-                              |Тип события
|group_code              |varchar(255)     |-|+|-                              |Код группы событий
|group_title             |varchar(255)     |-|-|-                              |Описание группы событий
|audit_code              |varchar(255)     |-|+|-                              |Код события
|audit_code_title        |varchar(255)     |-|-|-                              |Описание кода события
|event_date              |timestamp        |-|+|-                              |Дата события
|===

Таблицы *databasechangeloglock* и *databasechangeloglock* предназначены для управления миграциями базы данных.
Описание таблиц для работы с шаблонами фильтров приведено в разделе 3.2 (таблицы 3.7 - 3.12)

=== 3.13 Схема БД eca-web-push

На рисунке 3.7 приведена схема базы данных eca-web-push:

image::./images/eca-web-push-db-schema.png[alt=Схема базы данных eca-web-push,scaledwidth=80%]

=== 3.14 Описание таблиц БД eca-web-push

==== Таблица 3.{counter:db-table-id} - 'push_token' - содержит данные о пользовательских токенах для подключения через протокол web sockets
[cols="^20%,^14%,^8%,^8%,^8%,^30%",options="header"]
|===
|Название колонки|Тип|Unique|Not NULL|Индекс|Описание
|id                      |bigint            |+|+|+                               |Идентификатор записи (первичный ключ)
|user_name               |varchar(255)      |+|+|push_token_user_name_unique_idx |Логин пользователя
|token_id                |varchar(255)      |-|+|push_token_id_unique_idx        |Токен
|expire_at               |timestamp         |-|+|-                               |Дата истечения срока действия токена
|===

==== Таблица 3.{counter:db-table-id} - 'notification' - содержит данные об уведомлениях пользователей
[cols="^20%,^14%,^8%,^8%,^8%,^30%",options="header"]
|===
|Название колонки|Тип|Unique|Not NULL|Индекс|Описание
|id                      |bigint            |+|+|+                               |Идентификатор записи (первичный ключ)
|message_type            |varchar(255)      |+|+|-                               |Код сообщения
|message_text            |varchar(255)      |-|-|-                               |Текст сообщения
|initiator               |varchar(255)      |-|-|-                               |Инициатор уведомления
|receiver                |varchar(255)      |-|+|-                               |Получатель (пользователь)
|message_status          |varchar(255)      |-|+|-                               |Статус уведомления (READ, NOT_READ)
|created                 |timestamp         |-|+|-                               |Дата создания уведомления
|===

==== Таблица 3.{counter:db-table-id} - 'notification_parameter' - содержит данные о параметрах уведомлений
[cols="^20%,^14%,^8%,^8%,^8%,^30%",options="header"]
|===
|Название колонки|Тип|Unique|Not NULL|Индекс|Описание
|id                      |bigint            |+|+|+                                             |Идентификатор записи (первичный ключ)
|parameter_name          |varchar(255)      |+|+|+                                             |Название параметра
|parameter_value         |varchar(255)      |-|+|-                                             |Значение параметра
|notification_id         |bigint            |-|+|fk_notification_parameter_notification_id     |Внешний ключ уведомления
|===

Таблица содержит уникальный индекс *notification_parameter_id_parameter_name_unique_idx* на поля *id*, *parameter_name*.

Таблицы *databasechangeloglock* и *databasechangeloglock* предназначены для управления миграциями базы данных.

=== 3.15 Схема БД eca-data-loader

На рисунке 3.8 приведена схема базы данных eca-data-loader:

image::./images/data-loader-db-schema.png[alt=Схема базы данных eca-data-loader,scaledwidth=80%]

=== 3.16 Описание таблиц БД eca-data-loader

==== Таблица 3.{counter:db-table-id} - 'instances' - содержит данные об обучающих выборках
[cols="^20%,^14%,^8%,^8%,^8%,^30%",options="header"]
|===
|Название колонки|Тип|Unique|Not NULL|Индекс|Описание
|id                      |bigint           |+|+|+                                           |Идентификатор записи (первичный ключ)
|uuid                    |varchar(255)     |-|+|instances_uuid_unique_index                 |UUID обучающей выборки
|relation_name           |varchar(255)     |-|+|-                                           |Название обучающей выборки
|num_instances           |integer          |-|+|-                                           |Число объектов обучающей выборки
|num_attributes          |integer          |-|+|-                                           |Число атрибутов обучающей выборки
|num_classes             |integer          |-|+|-                                           |Число классов
|class_name              |varchar(255)     |-|+|-                                           |Название атрибута класса
|expire_at               |timestamp        |-|+|-                                           |Дата истечения срока действия объекта обучающей выборки
|created                 |timestamp        |-|+|-                                           |Дата создания
|md5_hash                |varchar(255)     |-|+|-                                           |MD5 хеш данных
|client_id               |varchar(255)     |-|-|-                                           |Имя технической учетной записи
|object_path             |varchar(255)     |-|+|-                                           |Путь к объекту в S3
|===

Таблица содержит уникальный индекс *instances_client_id_md5_hash_unique_index* на поля *client_id*, *md5_hash*.

Таблицы *databasechangeloglock* и *databasechangeloglock* предназначены для управления миграциями базы данных.

=== 3.17 Описание таблиц аудита

==== Таблица 3.{counter:db-table-id} - 'audit_group' - содержит данные о группах событий аудита
[cols="^20%,^14%,^8%,^8%,^8%,^30%",options="header"]
|===
|Название колонки|Тип|Unique|Not NULL|Индекс|Описание
|id                      |varchar(255)     |+|+|+                              |Код группы (первичный ключ)
|title                   |varchar(255)     |-|-|-                              |Описание группы
|===

==== Таблица 3.{counter:db-table-id} - 'audit_code' - содержит данные о кодах событий аудита
[cols="^20%,^14%,^8%,^8%,^8%,^30%",options="header"]
|===
|Название колонки|Тип|Unique|Not NULL|Индекс|Описание
|id                      |varchar(255)     |+|+|+                              |Код события (первичный ключ)
|title                   |varchar(255)     |-|-|-                              |Описание кода
|enabled                 |boolean          |-|+|-                              |Вкл./выкл. кода события
|audit_group_id          |varchar(255)     |-|+|fk_audit_code_group_id         |Внешний ключ группы событий
|===

==== Таблица 3.{counter:db-table-id} - 'audit_event_template' - содержит данные о шаблонах событий аудита
[cols="^20%,^14%,^8%,^8%,^8%,^30%",options="header"]
|===
|Название колонки|Тип|Unique|Not NULL|Индекс|Описание
|id                               |bigint           |+|+|+                                  |Идентификатор записи (первичный ключ)
|event_type                       |varchar(255)     |-|+|+                                  |Тип события
|message_template                 |varchar(1024)    |-|+|-                                  |Шаблон сообщения
|audit_code_id                    |varchar(255)     |-|+|fk_audit_event_template_code_id    |Внешний ключ кода события
|===

Таблица содержит уникальный индекс audit_event_template_code_id_event_type_unique_index на поля audit_code_id, event_type

=== 3.18 Описание служебных таблиц redelivery

==== Таблица 3.{counter:db-table-id} - 'retry_request' - содержит данные запросов для повторной отправки
[cols="^20%,^14%,^8%,^8%,^8%,^30%",options="header"]
|===
|Название колонки|Тип|Unique|Not NULL|Индекс|Описание
|id                                  |bigint           |+|+|+                                   |Идентификатор записи (первичный ключ)
|request_type                        |varchar(255)     |-|+|-                                   |Тип запроса (код)
|request                             |text             |-|+|-                                   |Тело запроса
|request_id                          |varchar(255)     |-|-|-                                   |Уникальный идентификатор запроса (внешний интеграционный ID)
|tx_id                               |varchar(255)     |-|-|-                                   |Идентификатор для кросс системного логирования
|retries                             |integer          |-|-|-                                   |Счетчик числа попыток повторной отправки запроса
|max_retries                         |integer          |-|-|-                                   |Макс. число попыток повторной отправки запроса
|created_at                          |timestamp        |-|+|-                                   |Дата создания записи
|retry_at                            |timestamp        |-|-|-                                   |Дата следующей попытки
|===

=== 3.19 Описание служебных таблиц form-templates

==== Таблица 3.{counter:db-table-id} - 'form_template_group' - содержит данные о группах шаблонов
[cols="^20%,^14%,^8%,^8%,^8%,^30%",options="header"]
|===
|Название колонки|Тип|Unique|Not NULL|Индекс|Описание
|id                      |bigint           |+|+|+                                     |Идентификатор записи (первичный ключ)
|group_name              |varchar(255)     |+|+|form_template_group_name_unique_idx   |Уникальный код группы
|group_title             |varchar(255)     |-|-|-                                     |Описание группы
|===

==== Таблица 3.{counter:db-table-id} - 'form_template' - содержит данные шаблонов crud форм
[cols="^20%,^14%,^8%,^8%,^8%,^30%",options="header"]
|===
|Название колонки|Тип|Unique|Not NULL|Индекс|Описание
|id                       |bigint           |+|+|+                             |Идентификатор записи (первичный ключ)
|template_name            |varchar(255)     |+|+|form_template_name_unique_idx |Уникальный код шаблона
|object_class             |varchar(255)     |-|-|-                             |Название класса ассоциированного с шаблоном
|object_type              |varchar(255)     |-|-|-                             |Тип объекта ассоциированного с шаблоном. Можно использовать как дискриминатор для опредения класса наследника.
|template_title           |varchar(255)     |-|+|-                             |Описание шаблона
|template_title_field_ref |varchar(255)     |-|-|-                             |Описание шаблона на основе значения из заданного поля шаблона
|group_id                 |bigint           |-|+|fk_form_template_group_id     |Внешний ключ, ID группы
|===

==== Таблица 3.{counter:db-table-id} - 'form_field_dictionary' - содержит данные словарей
[cols="^20%,^14%,^8%,^8%,^8%,^30%",options="header"]
|===
|Название колонки|Тип|Unique|Not NULL|Индекс|Описание
|id                         |bigint           |+|+|+                                 |Идентификатор записи (первичный ключ)
|_name                       |varchar(255)     |-|+|-                                 |Название словаря
|===

==== Таблица 3.{counter:db-table-id} - 'form_field_dictionary_value' - содержит данные значений словарей
[cols="^20%,^14%,^8%,^8%,^8%,^30%",options="header"]
|===
|Название колонки|Тип|Unique|Not NULL|Индекс|Описание
|id                         |bigint           |+|+|+                                               |Идентификатор записи (первичный ключ)
|_label                     |varchar(255)     |-|+|-                                               |Описание значения
|_value                     |varchar(255)     |-|+|-                                               |Код (значение)
|dictionary_id              |bigint           |-|+|fk_form_field_dictionary_value_dictionary_id    |Внешний ключ, ID словаря
|===

Таблица также содержит уникальный составной индекс form_field_dictionary_value_dictionary_id_unique_idx на поля (_value, dictionary_id)

==== Таблица 3.{counter:db-table-id} - 'form_field' - содержит данные полей для шаблонов
[cols="^20%,^14%,^8%,^8%,^8%,^30%",options="header"]
|===
|Название колонки|Тип|Unique|Not NULL|Индекс|Описание
|id                         |bigint           |+|+|+                                      |Идентификатор записи (первичный ключ)
|field_name                 |varchar(255)     |-|+|-                                      |Название поля
|description                |varchar(255)     |-|+|-                                      |Описание поля
|field_order                |integer          |-|+|-                                      |Порядок отображения поля
|field_type                 |varchar(255)     |-|+|-                                      |Тип поля для отображения, например TEXT, REFERENCE, DECIMAL, INTEGER, BOOLEAN.
|min_value                  |numeric(19,2)    |-|-|-                                      |Мин. значение (заполняется для числовых полей INTEGER, DECIMAL)
|min_inclusive              |boolean          |-|-|-                                      |Флаг для включения нижней границы
|max_value                  |numeric(19,2)    |-|-|-                                      |Макс. значение (заполняется для числовых полей INTEGER, DECIMAL)
|max_inclusive              |boolean          |-|-|-                                      |Флаг для включения верхней границы
|max_length                 |integer          |-|-|-                                      |Макс. длина поля
|pattern                    |varchar(255)     |-|-|-                                      |Регулярное выражение для поля
|invalid_pattern_message    |varchar(255)     |-|-|-                                      |Текст ошибки при несоответствии значения регулярному выражению (pattern)
|dictionary_id              |bigint           |-|-|fk_form_field_dictionary_id            |Внешний ключ, ID словаря (заполняется для полей типа REFERENCE)
|template_id                |bigint           |-|+|fk_form_template_id                    |Внешний ключ, ID шаблона
|place_holder               |varchar(255)     |-|-|-                                      |Значение для подсказки ввода
|default_value              |varchar(255)     |-|-|-                                      |Значение по умолчанию для поля
|read_only                  |boolean          |-|-|-                                      |Read only поле
|form_template_group_id     |bigint           |-|-|fk_form_field_form_template_group_id   |Внешний ключ, ID form_template_group (заполняется для полей типа ONE_OF_OBJECT, LIST_OBJECTS)
|===

=== 3.20 Описание служебных таблиц filter-templates

==== Таблица 3.{counter:db-table-id} - 'global_filter_template' - содержит конфигурацию полей для глобального поиска
[cols="^20%,^14%,^8%,^8%,^8%,^30%",options="header"]
|===
|Название колонки|Тип|Unique|Not NULL|Индекс|Описание
|id                      |bigint           |+|+|+                                        |Идентификатор записи (первичный ключ)
|filter_name             |varchar(255)     |-|+|-                                        |Название фильтра
|template_type           |varchar(255)     |-|+|global_filter_template_type_unique_idx   |Тип шаблона
|===

==== Таблица 3.{counter:db-table-id} - 'global_filter_field' - содержит данные полей для глобального поиска
[cols="^20%,^14%,^8%,^8%,^8%,^30%",options="header"]
|===
|Название колонки|Тип|Unique|Not NULL|Индекс|Описание
|id                         |bigint           |+|+|+                                 |Идентификатор записи (первичный ключ)
|field_name                 |varchar(255)     |-|+|-                                 |Название поля в сущности
|global_filter_template_id  |bigint           |-|+|fk_global_filter_template_id      |Внешний ключ, ID шаблона
|===

Таблица 3.{counter:db-table-id} - 'sort_template' - содержит конфигурацию полей для сортировки
[cols="^20%,^14%,^8%,^8%,^8%,^30%",options="header"]
|===
|Название колонки|Тип|Unique|Not NULL|Индекс|Описание
|id                      |bigint           |+|+|+                              |Идентификатор записи (первичный ключ)
|template_type           |varchar(255)     |-|+|sort_template_type_unique_idx  |Тип шаблона
|===

Таблица 3.{counter:db-table-id} - 'sort_field' - содержит данные полей для сортировки
[cols="^20%,^14%,^8%,^8%,^8%,^30%",options="header"]
|===
|Название колонки|Тип|Unique|Not NULL|Индекс|Описание
|id                         |bigint           |+|+|+                                 |Идентификатор записи (первичный ключ)
|field_name                 |varchar(255)     |-|+|-                                 |Название поля в сущности
|sort_template_id           |bigint           |-|+|fk_sort_field_sort_template_id    |Внешний ключ, ID шаблона
|===

==== Таблица 3.{counter:db-table-id} - 'filter_template' - содержит данные шаблонов фильтров для web приложения
[cols="^20%,^14%,^8%,^8%,^8%,^30%",options="header"]
|===
|Название колонки|Тип|Unique|Not NULL|Индекс|Описание
|id                      |bigint           |+|+|+                                 |Идентификатор записи (первичный ключ)
|template_name           |varchar(255)     |-|+|-                                 |Название шаблона
|template_type           |varchar(255)     |-|+|filter_template_type_unique_idx   |Тип шаблона
|created                 |timestamp        |-|-|-                                 |Дата создания шаблона
|===

==== Таблица 3.{counter:db-table-id} - 'filter_dictionary' - содержит данные словарей
[cols="^20%,^14%,^8%,^8%,^8%,^30%",options="header"]
|===
|Название колонки|Тип|Unique|Not NULL|Индекс|Описание
|id                         |bigint           |+|+|+                                 |Идентификатор записи (первичный ключ)
|_name                      |varchar(255)     |-|+|filter_dictionary_name_unique_idx |Название словаря
|===

==== Таблица 3.{counter:db-table-id} - 'filter_dictionary_value' - содержит данные значений словарей
[cols="^20%,^14%,^8%,^8%,^8%,^30%",options="header"]
|===
|Название колонки|Тип|Unique|Not NULL|Индекс|Описание
|id                         |bigint           |+|+|+                                 |Идентификатор записи (первичный ключ)
|_label                     |varchar(255)     |-|+|-                                 |Описание значения
|_value                     |varchar(255)     |-|+|-                                 |Значение
|filter_dictionary_id       |bigint           |-|+|fk_filter_dictionary_id           |Внешний ключ, ID словаря
|===

==== Таблица 3.{counter:db-table-id} - 'filter_field' - содержит данные полей для фильтров
[cols="^20%,^14%,^8%,^8%,^8%,^30%",options="header"]
|===
|Название колонки|Тип|Unique|Not NULL|Индекс|Описание
|id                         |bigint           |+|+|+                                 |Идентификатор записи (первичный ключ)
|field_name                 |varchar(255)     |-|+|-                                 |Название поля в сущности
|description                |varchar(255)     |-|+|-                                 |Описание поля
|field_order                |integer          |-|+|-                                 |Порядок отображения поля в фильтре
|filter_field_type          |varchar(255)     |-|+|-                                 |Тип поля для отображения, например TEXT, DATE, REFERENCE, LAZY_REFERENCE.
|match_mode                 |varchar(255)     |-|+|-                                 |Тип фильтрации по полю, например EQUALS, LIKE, RANGE.
|multiple                   |boolean          |-|-|-                                 |Допускается фильтрация по нескольким значениям поля
|filter_dictionary_id       |bigint           |-|-|fk_filter_field_dictionary_id     |Внешний ключ, ID словаря (заполняется для полей типа REFERENCE)
|filter_template_id         |bigint           |-|+|fk_filter_template_id             |Внешний ключ, ID шаблона
|===

=== 3.21 Описание служебных таблиц user-profile-options

Таблица 3.{counter:db-table-id} - 'user_profile_options_data' - содержит данные о настройках профилей пользователей
[cols="^20%,^14%,^8%,^8%,^8%,^30%",options="header"]
|===
|Название колонки|Тип|Unique|Not NULL|Индекс|Описание
|id                               |bigint           |+|+|+                                           |Идентификатор записи (первичный ключ)
|_user                            |varchar(255)     |-|+|user_profile_options_data_user_unique_idx   |Логин пользователя
|created                          |timestamp        |-|+|-                                           |Дата создания
|updated                          |timestamp        |-|+|-                                           |Дата обновления
|version                          |integer          |-|+|-                                           |Версия настроек
|options_json                     |varchar(4096)    |-|+|-                                           |Настройки профиля в формате json
|===
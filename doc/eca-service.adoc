= Техническая документация системы ECA SERVICE
:toc: macro

== Введение

Программная система представляет собой серверное решение для построения различных моделей классификаторов, а также
расчёта их основных показателей точности. Система поддерживает построение одиночных и ансамблевых моделей классификаторов.

== 1. Функции системы

1. Построение одиночных и ансамблевых моделей классификаторов.
2. API Data Miner, основным предназначением которого является автоматический подбор оптимальных
параметров для одиночных и ансамблевых алгоритмов на основе серии экспериментов.
3. Наполнение базы знаний результатов классификации разнотипных данных с использованием
различных алгоритмов классификации, как одиночных так и ансамблевых.
4. API для нахождения оптимальных параметров классификаторов для конкретной обучающей выборки на основе накопленной
истории результатов классификации.
5. UI для работы с заявками на построение моделей классификаторов.
6. Возможность добавления/изменения конфигураций экспериментов через UI.
7. Административная панель для управления пользователями системы.
8. Личный кабинет пользователя с основными операциями:

    * Редактирование основных данных (ФИО и т.д.)
    * Изменение email
    * Изменение пароля
    * Восстановление пароля
    * Загрузка аватара
9. UI для сохранения файлов с обучающей выборкой в БД в виде таблиц.

== 2. Архитектура решения

=== 2.1 Диаграмма взаимодействия компонентов

На рисунке 2.1 представлена диаграмма взаимодействия основных компонентов системы Eca - service, за исключением
связей с системными сервисами мониторинга, логирования:

image::./images/es-architecture.png[alt=Диаграмма взаимодействия компонентов,scaledwidth=80%]

==== Таблица 1.1 - Описание компонентов диграммы взаимодействия

|===
|№|Компонент|Описание
|1
|Eca desktop
|Представляет собой настольное приложение ECA, установленное на ПК
|2
|Browser
|Представляет собой административную панель для работы с заявками на построение моделей классификаторов
|3
|Eca web
|Angular приложение, обернутое в spring boot. Реализует Web клиент для работы с заявками на построение моделей классификаторов
|4
|Rabbit MQ
|Брокер сообщений на построение моделей от Eca desktop
|5
|API gateway (zuul gate)
|Модуль единой точки входа для проксирования http запросов во внутренние микросервисы
|6
|Discovery server
|Eureka сервер для регистрации микросервисов
|7
|Eca server
|Основной модуль, который принимает сообщения для обучения моделей классификаторов. Модуль предоставляет REST API по работе с заявками для web приложения.
|8
|Eca oauth
|Модуль авторизации и управления пользователями. Модуль предоставляет REST API по работе с пользователями для web приложения.
|9
|Eca ers
|Сервис для хранения и анализа результатов классификации. Сервис предоставляет REST API для получения/сохранения результатов классификации.
|10
|Eca data storage
|Модуль для хранения обучающих выборок в виде таблиц БД. Модуль предоставляет REST API по работе с выборками для web приложения.
|11
|Eca mail
|Модуль для отправки почты и хранения шаблонов email - сообщений. Модуль предоставляет REST API для отправки нотификаций в соответствии с заданным шаблоном сообщения.
|12
|PostgreSQL
|База данных PostgreSQL для конкретного микросервиса
|13
|Redis
|Распределенная in-memory БД для хранения временных данных
|===

=== 2.2 Диаграмма взаимодействия с системными сервисами

На рисунке 2.2 представлена полная диаграмма взаимодействия с системными сервисами:

image::./images/es-ss-architecture.png[alt=Диаграмма взаимодействия с системными сервисами,scaledwidth=80%]

==== Таблица 1.2 - Описание компонентов диграммы взаимодействия с системными сервисами

|===
|№|Компонент|Описание
|1
|Eca - service
|Система eca - service
|2
|PostgreSQL
|Сервер PostgreSQL с основными БД приложения
|3
|Rabbit MQ
|Брокер сообщений
|4
|Prometheus
|Система для сбора метрик с основных компонентов приложения
|5
|Grafana
|Web клиент для визуализации метрик из prometheus
|6
|Alertmanager
|Система для отправки уведомлений мониторинга в различные каналы
|7
|Alertmanager adapter
|Интеграционный адаптер для преобразования запросов от alertmanager в форматы для отправки в различные каналы
|8
|SMTP server
|Сервер для отправки почты с уведомлениями мониторинга
|9
|Telegram
|Telegram канал для полученя уведомлений мониторинга
|10
|Filebeat
|Система для чтения логов docker - контейнеров с последующей их отправкой в elasticsearch хранилище
|11
|Elasticsearch
|Хранилище логов для всех микросервисов
|12
|Kibana
|Web клиент для просмотра логов
|===

=== 2.3 Диаграмма последовательности для построения модели классификатора

На рисунке 2.3 представлена диаграмма последовательности для построения модели классификатора:

image::./images/evaluation-request-sequence.png[alt=Диаграмма последовательности для построения модели классификатора,scaledwidth=80%]

=== 2.4 Диаграмма последовательности для построения оптимального классификатора

На рисунке 2.4 представлена диаграмма последовательности для построения оптимального классификатора:

image::./images/evaluation-optimizer-request-sequence.png[alt=Диаграмма последовательности для построения оптимального классификатора,scaledwidth=80%]

=== 2.5 Диаграмма последовательности для создания заявки на эксперимент

На рисунке 2.4 представлена диаграмма последовательности для создания заявки на эксперимент:

image::./images/experiment-request-sequence.png[alt=Диаграмма последовательности для создания заявки на эксперимент,scaledwidth=80%]

== 3. Схема базы данных

=== 3.1 Схема БД eca-server

На рисунке 3.1 приведена схема базы данных eca - server:

image::./images/eca-db-schema.png[alt=Схема базы данных eca - server,scaledwidth=80%]

=== 3.2 Схема БД eca-oauth

=== 3.3 Схема БД eca-ers

=== 3.4 Схема БД eca-data-storage

=== 3.5 Схема БД eca-mail

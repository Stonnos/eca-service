= Модуль ECA - SERVER (v6.1)
:toc:
:toc-title: Оглавление

== 1. Описание модуля

1. Данный модуль предназначен для построения различных моделей классификаторов, а также расчёта основных показателей точности. Сервис поддерживает построение как одиночных, так и ансамблевых моделей.

2. Сервис также предоставляет API Data Miner, основным предназначением которого является автоматический подбор оптимальных параметров для одиночных и ансамблевых алгоритмов на основе серии экспериментов.

3. Интеграция с сервисом ERS (Evaluation results service). API предоставляет возможность отправки результатов классификации в сервис для последующего анализа, а также нахождение
оптимальных конфигураций классификаторов для конкретной обучающей выборки на основе истории результатов классификации.

Для интеграции с eca - service, на клиенте должна быть установлена самая последняя версия eca-core (6.8.7), в которой реализованы такие классы как: AbstractClassifier, Instances, EvaluationResults.

== 2. Описание очередей

Сервис поддерживает асинхронную интеграцию с помощью очередей Rabbit MQ. Ниже приведено описание входящих очередей сервера:

[options="header"]
|===
|Название очереди|Описание
|evaluation-request-queue
|Очередь для отправки запросов на построение моделей классификаторов
|evaluation-optimizer-request-queue
|Очередь для отправки запросов на построение моделей классификаторов с оптимальными настройками
|experiment-request-queue
|Очередь для отправки запроса на создание заявки на эксперимент
|===

ВАЖНО! При отправке запросов в MQ необходимо заполнять заголовки reply-to и correlation-id. В заголовке reply-to
указывается название очереди для получения ответов от сервиса, в заголовке correlation-id задается уникальный
идентификатор сообщения для корреляции.

== 3. Описание формата отправки запроса на обучение модели классификатора

=== 3.1. Пример запроса на обучение модели классификатора

[source,json]
----
{
  "classifier": "<Base64 classifier>",
  "data": "<Base64 data>",
  "evaluationMethod": "CROSS_VALIDATION",
  "numFolds": 10,
  "numTests": 1,
  "seed": 1
}
----

=== 3.2. Описание полей запроса на обучение модели классификатора

[options="header"]
|===
|№|Название поля|Тип|Обязательное|Описание|Комментарий
|1
|classifier
|Base64 of AbstractClassifier
|+
|Base64 представление классификатора с заданными входными параметрами
|Допускается любой классификатор, производный от AbstractClassifier из библиотеки weka
|2
|data
|Base64 of Instances
|+
|Base64 представление обучающей выборки для построения классификатора
|Объект типа Instances из библиотеки weka
|3
|evaluationMethod
|string
|+
|Метод оценки точности классификатора
|Заполняется по справочнику <<Справочник значений EvaluationMethod>>
|4
|numFolds
|integer
|-
|Число блоков для метода V - блочной кросс проверки
|
|5
|numTests
|integer
|-
|Число тестов для метода V - блочной кросс проверки
|
|6
|seed
|integer
|-
|Начальное значение для генератора псевдослучайных чисел
|
|===

=== 3.3. Пример ответа на запрос для обучения модели классификатора

[source,json]
----
{
  "requestId": "1cec4e54-0f46-4d70-ad19-a8f9f1a0e33c",
  "status": "SUCCESS",
  "evaluationResults": "<Base64 evaluation results>"
}
----

=== 3.4. Пример ответа с ошибкой

[source,json]
----
{
  "requestId": "1cec4e54-0f46-4d70-ad19-a8f9f1a0e33c",
  "status": "ERROR",
  "errors": [
    {
      "code": "NotNull",
      "fieldName": "classifier",
      "errorMessage": "Expected not null value"
    }
  ]
}
----

=== 3.5. Описание полей ответа на запрос для обучения модели классификатора

[options="header"]
|===
|№|Название поля|Тип|Обязательное|Описание|Комментарий
|1
|requestId
|string
|+
|Идентификатор запроса
|
|2
|status
|string
|+
|Статус ответа
|Заполнятся по <<Справочник значений TechnicalStatus>>
|3
|errors
|MessageError list
|-
|Список ошибок
|Заполняется в случае, если произошла какая либо ошибка
|4
|evaluationResults
|Base64 of EvaluationResults
|-
|Результаты классификации, включая построенную модель классификатора
|Заполняется только в случае, если значение статуса ответа SUCCESS
|===

== 4. Описание формата заявки на эксперимент

=== 4.1. Пример запроса на построение экперимента

[source,json]
----
{
  "firstName": "<First name>",
  "email": "<email>",
  "experimentType": "RANDOM_FORESTS",
  "data": "<Base64 data>",
  "evaluationMethod": "CROSS_VALIDATION"
}
----

=== 4.2. Описание полей заявки на построение экперимента

[options="header"]
|===
|№|Название поля|Тип|Обязательное|Длина|Описание|Комментарий
|1
|firstName
|string
|+
|30
|Имя
|Используется для приветствия в ответном письме с результатами эксперимента
|2
|email
|string
|+
|50
|Email, на который будет отправлено письмо с результатами эксперимента
|Здесь задается email, на который будет отправлено письмо с результатами эксперимента
|3
|experimentType
|string
|+
|-
|Тип эксперимента
|Заполняется по справочнику <<Справочник значений ExperimentType>>
|4
|data
|Base64 of Instances
|+
|-
|Base64 представление обучающей выборки для построения классификатора
|Объект типа Instances из библиотеки weka
|5
|evaluationMethod
|string
|+
|-
|Метод оценки точности классификатора
|Заполняется по справочнику <<Справочник значений EvaluationMethod>>
|===

=== 4.3. Пример ответа на запрос для построение эксперимента

[source,json]
----
{
  "requestId": "1cec4e54-0f46-4d70-ad19-a8f9f1a0e33c",
  "status": "SUCCESS"
}
----

=== 4.4. Описание полей ответа на заявку для построение эксперимента

[options="header"]
|===
|№|Название поля|Тип|Обязательное|Описание|Комментарий
|1
|requestId
|string
|+
|Идентификатор запроса
|
|2
|status
|string
|+
|Статус ответа
|Заполнятся по <<Справочник значений TechnicalStatus>>
|3
|errors
|MessageError list
|-
|Список ошибок
|Заполняется в случае, если произошла какая либо ошибка
|===

== 5. Описание формата отправки запроса на нахождение оптимального классификатора

=== 5.1. Пример запроса на нахождение оптимального классификатора

[source,json]
----
{
  "data": "<Base64 data>"
}
----

=== 5.2. Описание полей запроса на нахождение оптимального классификатора

[options="header"]
|===
|№|Название поля|Тип|Обязательное|Описание|Комментарий
|1
|data
|Base64 of Instances
|+
|Base64 представление обучающей выборки для построения классификатора
|Объект типа Instances из библиотеки weka
|===

=== 5.3. Пример ответа на запрос для нахождение оптимального классификатора

[source,json]
----
{
  "requestId": "1cec4e54-0f46-4d70-ad19-a8f9f1a0e33c",
  "status": "SUCCESS",
  "evaluationResults": "<Base64 evaluation results>"
}
----

=== 5.4. Описание полей ответа на запрос для нахождение оптимального классификатора

[options="header"]
|===
|№|Название поля|Тип|Обязательное|Описание|Комментарий
|1
|requestId
|string
|+
|Идентификатор запроса
|
|2
|status
|string
|+
|Статус ответа
|Заполнятся по <<Справочник значений TechnicalStatus>>
|2
|errors
|MessageError list
|-
|Список ошибок
|Заполняется в случае, если произошла какая либо ошибка
|3
|evaluationResults
|Base64 of EvaluationResults
|-
|Результаты классификации, включая построенную модель классификатора
|Заполняется только в случае, если значение статуса ответа SUCCESS
|===

== 6. Описание полей MessageError

[options="header"]
|===
|№|Название поля|Тип|Обязательное|Описание|Комментарий
|1
|code
|string
|+
|Код ошибки
|
|2
|fieldName
|string
|-
|Название поля для которого возникла ошибка
|Заполняется для ошибок валидации
|3
|message
|string
|+
|Текст ошибки
|
|===

== Справочник значений EvaluationMethod

[options="header"]
|===
|№|Значение|Описание
|1
|TRAINING_DATA
|Использование всей обучающей выборки для оценки точности классификатора
|2
|CROSS_VALIDATION
|Метод k * V - блочной кросс проверки на тестовой выборке
|===

== Справочник значений TechnicalStatus

[options="header"]
|===
|№|Код ответа|Описание
|1
|SUCCESS
|Статус усешного ответа
|2
|ERROR
|Произошла какая либо ошибка
|3
|TIMEOUT
|Произошел таймаут
|4
|VALIDATION_ERROR
|Ошибки валидации входных параметров
|===

== Справочник значений ExperimentType

[options="header"]
|===
|№|Код ответа|Описание
|1
|NEURAL_NETWORKS
|Автоматический подбор оптимальных параметров для нейронных сетей
|2
|HETEROGENEOUS_ENSEMBLE
|Автоматический подбор оптимальных параметров для неоднородного ансамблевого алгоритма
|3
|MODIFIED_HETEROGENEOUS_ENSEMBLE
|Автоматический подбор оптимальных параметров для модифицированного неоднородного ансамблевого алгоритма
|4
|ADA_BOOST
|Автоматический подбор оптимальных параметров для алгоритма AdaBoost
|5
|STACKING
|Автоматический подбор оптимальных параметров для алгоритма Stacking
|6
|KNN
|Автоматический подбор оптимальных параметров для алгоритма KNN
|7
|RANDOM_FORESTS
|Автоматический подбор оптимальных параметров для алгоритма RandomForests
|8
|STACKING_CV
|Автоматический подбор оптимальных параметров для алгоритма Stacking CV
|9
|DECISION_TREE
|Автоматический подбор оптимальных параметров для деревьев решений
|===

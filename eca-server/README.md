ECA server
========================================

Описание
----------------------------------------
1. Данный сервис предназначен для построения различных моделей классификаторов, а также
расчёта их основных показателей точности. Сервис поддерживает построение как
одиночных, так и ансамблевых моделей.
2. Сервис также предоставляет API Data Miner, основным предназначением которого
является автоматический подбор оптимальных параметров для одиночных и ансамблевых алгоритмов
на основе серии экспериментов.
3. Интеграция с внешним сервисом ERS (Evaluation results service). API предоставляет возможность
отправки результатов классификации во внешних сервис для последующего анализа, а также нахождение
оптимальных конфигураций классификаторов для конкретной обучающей выборки на
основе истории результатов классификации.

Необходимый софт
----------------------------------------
* jdk 1.8
* maven => 3.3.9
* Rabbit MQ => 3
* eca-core 6.7
* Postgres Database для хранения информации => 9.6
* Контейнер сервлетов Tomcat 8

Описание ключевой конфигурации модуля
----------------------------------------
Настройки для проекта eca-server находятся в application.yml. Основные параметры:
1) spring.datasource - настройки БД для хранения информации
2) cross-validation — настройки параметров для метода k * V блочной кросс - проверки
   на тестовой выборке:
   * cross-validation.numFolds - число блоков
   * cross-validation.numTests - число тестов
   * cross-validation.seed - начальное значение для генератора псевдослучайных чисел
   * cross-validation.timeout - таймаут в сек. для оценки точности классификатора
3) experiment - настройки параметров модуля Data Miner. Ниже приведено описание
   основных настроек:
   * experiment.resultSize - число наилучших конфигураций классификаторов
   * experiment.numIterations - число итераций эксперимента
   * experiment.storagePath - путь к папке на файловой системе для хранения файлов с историей экспериментов
   * experiment.individualClassifiersStoragePath - путь к папке в ресурсах для хранения json - конфигураций классификаторов,
   которые впоследствии будут использоваться при построении эксперимента
   * experiment.downloadBaseUrl - базовый url ссылки на скачивание файла с результатами эксперимента
   * experiment.maximumFractionDigits - число десятичных знаков после запятой
   * experiment.numberOfDaysForStorage - кол-во дней для хранения файлов с результатами экспериментов
   * experiment.removeExperimentCron - крон выражение для удаления файлов с результатами экспериментов
   * experiment.ersSendingCron - крон выражение для отправки результатов экспериментов в ERS - сервис
   * experiment.timeout - время таймаута эксперимента в часах.
   * experiment.delay - интервал между запусками scheduler для обработки экспериметов
   * experiment.data.storagePath - путь к папке на файловой системе для хранения файлов с исходныи данными (обучающая выборка)
   * experiment.ensemble.numIterations - число итераций для ансамблевых алгоритмов
   * experiment.ensemble.numBestClassifiers - число наилучших по точности базовых классификаторов, которые впоследствии
   будут использоваться при построении ансамбля
   * experiment.ensemble.multiThreadModeEnabled - многопоточный режим для ансамблевых алгоритмов (вкл./выкл.)
   * experiment.ensemble.numThreads - число используемых потоков
   * experiment.ensemble.numFoldsForStacking - число блоков V - блочной кросс - проверки для алгоритма Stacking
4) ers - настройки интеграции с сервисом evaluation-results-service
   * ers.url - url конечной точки ERS сервиса
   * ers.enabled - выключатель для отправки результатов классификации (вкл./выкл.)
5) common - общие настройки
   * common.classifierOptionsCacheDurationInDays - период хранения оптимальных настроек классификатора
      полученных от внешнего сервиса ERS
   * common.threadPoolSize - число потоков для асинхронных задач
   * common.maxPageSize - максимальное число элементов на странице (используется для запросов с пагинацией)
6) cache.specs - настройки spring cache
7) swagger2 - настройки Swagger
   * swagger2.tokenBaseUrl - базовый url - сервера авторизации
   * swagger2.clientId - идентификатор клиента
   * swagger2.secret - пароль клиента
   * swagger2.groups - Groups map с мета информацией для swagger

Инструкция по развертыванию
----------------------------------------

1. Собрать проект с помощью команды:
    
   mvn clean install
    
2. Развернуть target/eca-server.war на одном из контейнеров сервлетов (например, Tomcat 8) с контекстом /eca-server.
         
3. Страница с документацией swagger находится по адресу http://[host]:[port]/eca-server/swagger-ui.html, где host и port
соответственно адрес машины и порт на котором развернуто приложение.

Интеграционные тесты
------------------------------------------------------
Для запуска всех интеграционых тестов необходимо выполнить команду (указав профиль quality):

mvn clean install -Pquality

С параметрами:
-Ders-config.url=http://localhost:8089/evaluation-results-service/ws/
-Ders-config.enabled=true

Инструкция по развертыванию в Docker
-------------------------------------------------------

1. Для Windows 10 достаточно скачать и установить дистрибутив Docker Desktop (https://www.docker.com/products/docker-desktop).
   
   Для Linux сначала необходимо установить Docker CE (https://docs.docker.com/install/linux/docker-ce/ubuntu/),
   затем Docker compose (https://docs.docker.com/compose/install/).

2. Далее для сборки проекта и создания образа проекта нужно выполнить команду:

    mvn clean install dockerfile:build

3. Используя пакетный менеджер docker-compose, создать docker контейнеры с помощью команды:

    docker-compose up -d

ВАЖНО! Данную команду необходимо выполнять из корневой папки проекта.

Для остановки приложения (удаления контейнеров) нужно выполнить команду:

docker-compose down

Для удаления всех контейнеров и image-ов необходимо выполнить команду:

docker-compose down --rmi all

Основные команды Docker
-------------------------------------------------------

Для просмотра image-ов, необходимо выполнить команду:

docker images

Для просмотра запущенных контейнеров, необходимо выполнить команду:

docker ps

Для удаления контейнера, необходимо выполнить команду:

docker rm container_name

Для удаления image, необходимо выполнить команду:

docker image rm image_id

Для просмотра доступных сетей, необходимо выполнить команду:

docker network ls

Для того чтобы подключится к контейнеру, необходимо выполнить команду:

docker exec -it container_name bash

Для копирования новой версии war файла в контейнер (container_name), необходимо выполнить команду:

docker cp application.war container_name:/usr/local/tomcat/webapps/

ВАЖНО! Данную команду необходимо выполнять из директории, в которой лежит war файл.
Либо можно указать абсолютный путь к war - файлу.
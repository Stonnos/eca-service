= Microservice for users managment
Автор: Roman Batygin <roman.batygin@mail.ru>
:toc:
:toc-title: Оглавление

== Описание

API provides operations with users for ECA web application

== Updates info for current authenticated user

*PUT*
*/users/update-info* - Updates info for current authenticated user

|===
|Формат запроса|Обязательность|Тело запроса
|application/json
|true
|<<UpdateUserInfoDto>>
|===
== Uploads photo for current authenticated user

*POST*
*/users/upload-photo* - Uploads photo for current authenticated user

|===
|Формат запроса|Обязательность|Тело запроса
|multipart/form-data
|false
|-
|===
== Unlocks user

*POST*
*/users/unlock* - Unlocks user

|===
|Название параметра|Описание параметра|Тип|Тип данных|Обязательность|Мин. длина|Макс. длина
|userId
|User id
|query
|integer (int64)
|true
|-
|-
|===
== Enable/disable tfa for current authenticated user

*POST*
*/users/tfa* - Enable/disable tfa for current authenticated user

|===
|Название параметра|Описание параметра|Тип|Тип данных|Обязательность|Мин. длина|Макс. длина
|enabled
|Tfa enabled flag
|query
|boolean 
|true
|-
|-
|===
== Logout current user and revokes access/refresh token pair

*POST*
*/users/logout* - Logout current user and revokes access/refresh token pair

== Locks user

*POST*
*/users/lock* - Locks user

|===
|Название параметра|Описание параметра|Тип|Тип данных|Обязательность|Мин. длина|Макс. длина
|userId
|User id
|query
|integer (int64)
|true
|-
|-
|===
== Finds users with specified options

*POST*
*/users/list* - Finds users with specified options

|===
|Формат запроса|Обязательность|Тело запроса
|application/json
|true
|<<PageRequestDto>>
|===
[source,json]
----
{
  "page" : 0,
  "size" : 25
}
----
== Creates new user

*POST*
*/users/create* - Creates new user

|===
|Формат запроса|Обязательность|Тело запроса
|application/json
|true
|<<CreateUserDto>>
|===
== Verify reset password token

*POST*
*/password/verify-token* - Verify reset password token

|===
|Название параметра|Описание параметра|Тип|Тип данных|Обязательность|Мин. длина|Макс. длина
|token
|Reset password token
|query
|string 
|true
|-
|-
|===
== Reset password with specified token

*POST*
*/password/reset* - Reset password with specified token

|===
|Формат запроса|Обязательность|Тело запроса
|application/json
|true
|<<ResetPasswordRequest>>
|===
== Creates forgot password request

*POST*
*/password/forgot* - Creates forgot password request

|===
|Формат запроса|Обязательность|Тело запроса
|application/json
|true
|<<ForgotPasswordRequest>>
|===
== Creates change password request

*POST*
*/password/change/request* - Creates change password request

|===
|Формат запроса|Обязательность|Тело запроса
|application/json
|true
|<<ChangePasswordRequest>>
|===
== Confirms change password request

*POST*
*/password/change/confirm* - Confirms change password request

|===
|Название параметра|Описание параметра|Тип|Тип данных|Обязательность|Мин. длина|Макс. длина
|token
|Token value
|query
|string 
|true
|-
|-
|===
== Creates change email request

*POST*
*/email/change/request* - Creates change email request

|===
|Название параметра|Описание параметра|Тип|Тип данных|Обязательность|Мин. длина|Макс. длина
|newEmail
|User email
|query
|string 
|true
|0
|255
|===
== Confirms change email request

*POST*
*/email/change/confirm* - Confirms change email request

|===
|Название параметра|Описание параметра|Тип|Тип данных|Обязательность|Мин. длина|Макс. длина
|token
|Token value
|query
|string 
|true
|-
|-
|===
== Gets current authenticated user info

*GET*
*/users/user-info* - Gets current authenticated user info

== Downloads user photo

*GET*
*/users/photo/{id}* - Downloads user photo

|===
|Название параметра|Описание параметра|Тип|Тип данных|Обязательность|Мин. длина|Макс. длина
|id
|Photo id
|path
|integer (int64)
|true
|-
|-
|===
== Deletes photo for current authenticated user

*DELETE*
*/users/delete-photo* - Deletes photo for current authenticated user


== Описание форматов для запросов
=== UpdateUserInfoDto
:table-caption: Таблица
.Update user info model
|===
|Название параметра|Описание параметра|Тип данных|Обязательность|Мин. длина|Макс. длина|Паттерн
|*firstName*[red]##*##
|First name
|string 
|true
|2
|30
|`^([A-Z][a-z]+)|([А-Я][а-я]+)$`
|*lastName*[red]##*##
|Last name
|string 
|true
|2
|30
|`^([A-Z][a-z]+)|([А-Я][а-я]+)$`
|*middleName*[red]##*##
|Middle name
|string 
|true
|2
|30
|`^([A-Z][a-z]+)|([А-Я][а-я]+)$`
|===
=== FilterRequestDto
:table-caption: Таблица
.Filter request model
|===
|Название параметра|Описание параметра|Тип данных|Обязательность|Мин. длина|Макс. длина|Паттерн
|*name*[red]##*##
|Filter column name
|string 
|true
|0
|255
|-
|*values*[red]##*##
|-
|array 
|false
|-
|-
|-
|*matchMode*[red]##*##
|Match mode type
|string 
|true
|-
|-
|-
|===
=== PageRequestDto
:table-caption: Таблица
.Page request model
|===
|Название параметра|Описание параметра|Тип данных|Обязательность|Мин. длина|Макс. длина|Паттерн
|*page*[red]##*##
|Page number
|integer (int32)
|true
|-
|-
|-
|*size*[red]##*##
|Page size
|integer (int32)
|true
|-
|-
|-
|*sortField*[red]##*##
|Sort field
|string 
|false
|0
|255
|-
|*ascending*[red]##*##
|Is ascending sort?
|boolean 
|false
|-
|-
|-
|*searchQuery*[red]##*##
|Search query string
|string 
|false
|0
|255
|-
|*filters*[red]##*##
|Filters list
|array 
|false
|-
|-
|-
|===
=== PageDtoUserDto
:table-caption: Таблица
.Page model
|===
|Название параметра|Описание параметра|Тип данных|Обязательность|Мин. длина|Макс. длина|Паттерн
|*content*[red]##*##
|Page content
|array 
|false
|-
|-
|-
|*page*[red]##*##
|Page number
|integer (int32)
|false
|-
|-
|-
|*totalCount*[red]##*##
|Total elements count in all pages
|integer (int64)
|false
|-
|-
|-
|===
=== RoleDto
:table-caption: Таблица
.User role model
|===
|Название параметра|Описание параметра|Тип данных|Обязательность|Мин. длина|Макс. длина|Паттерн
|*roleName*[red]##*##
|Role name
|string 
|false
|-
|-
|-
|*description*[red]##*##
|Role description
|string 
|false
|-
|-
|-
|===
=== UserDto
:table-caption: Таблица
.User model
|===
|Название параметра|Описание параметра|Тип данных|Обязательность|Мин. длина|Макс. длина|Паттерн
|*id*[red]##*##
|User id
|integer (int64)
|false
|-
|-
|-
|*login*[red]##*##
|User login
|string 
|false
|-
|-
|-
|*email*[red]##*##
|User email
|string 
|false
|-
|-
|-
|*firstName*[red]##*##
|User first name
|string 
|false
|-
|-
|-
|*lastName*[red]##*##
|User last name
|string 
|false
|-
|-
|-
|*middleName*[red]##*##
|User middle name
|string 
|false
|-
|-
|-
|*fullName*[red]##*##
|User full name
|string 
|false
|-
|-
|-
|*creationDate*[red]##*##
|User creation date
|string 
|false
|-
|-
|-
|*tfaEnabled*[red]##*##
|Two factor authentication enabled
|boolean 
|false
|-
|-
|-
|*locked*[red]##*##
|Account locked
|boolean 
|false
|-
|-
|-
|*photoId*[red]##*##
|User photo id
|integer (int64)
|false
|-
|-
|-
|*passwordDate*[red]##*##
|Last password change date
|string 
|false
|-
|-
|-
|*roles*[red]##*##
|User roles
|array 
|false
|-
|-
|-
|===
=== CreateUserDto
:table-caption: Таблица
.Create user model
|===
|Название параметра|Описание параметра|Тип данных|Обязательность|Мин. длина|Макс. длина|Паттерн
|*login*[red]##*##
|User login
|string 
|true
|3
|32
|`^[a-z0-9]+$`
|*email*[red]##*##
|User email
|string 
|true
|0
|255
|-
|*firstName*[red]##*##
|First name
|string 
|true
|2
|30
|`^([A-Z][a-z]+)|([А-Я][а-я]+)$`
|*lastName*[red]##*##
|Last name
|string 
|true
|2
|30
|`^([A-Z][a-z]+)|([А-Я][а-я]+)$`
|*middleName*[red]##*##
|Middle name
|string 
|true
|2
|30
|`^([A-Z][a-z]+)|([А-Я][а-я]+)$`
|===
=== ResetPasswordRequest
:table-caption: Таблица
.Reset password request model
|===
|Название параметра|Описание параметра|Тип данных|Обязательность|Мин. длина|Макс. длина|Паттерн
|*token*[red]##*##
|Token value
|string 
|true
|-
|-
|-
|*password*[red]##*##
|New password
|string 
|true
|-
|-
|-
|===
=== ForgotPasswordRequest
:table-caption: Таблица
.Forgot password request model
|===
|Название параметра|Описание параметра|Тип данных|Обязательность|Мин. длина|Макс. длина|Паттерн
|*email*[red]##*##
|User email
|string 
|true
|-
|-
|-
|===
=== ChangePasswordRequest
:table-caption: Таблица
.Change password request model
|===
|Название параметра|Описание параметра|Тип данных|Обязательность|Мин. длина|Макс. длина|Паттерн
|*oldPassword*[red]##*##
|Old password
|string 
|true
|-
|-
|-
|*newPassword*[red]##*##
|New password
|string 
|true
|-
|-
|-
|===

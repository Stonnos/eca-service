= Microservice for users managment
Автор: Roman Batygin <roman.batygin@mail.ru>
:toc:
:toc-title: Оглавление

== Описание

API provides operations with users for ECA web application

== Updates info for current authenticated user

*PUT*
*/users/update-info* - Updates info for current authenticated user

|===
|Формат запроса|Обязательность|Тело запроса|Пример запроса
|application/json
|true
|<<UpdateUserInfoDto>>
a|
-
|===
Список кодов ответа
|===
|Код ответа|Описание|Формат ответа|Пример ответа
|401
|Not authorized
|application/json
a|
[source,json]
----
{
  "error" : "unauthorized",
  "error_description" : "Full authentication is required to access this resource"
}
----
|400
|Bad request
|-
a|
-
|===

== Uploads photo for current authenticated user

*POST*
*/users/upload-photo* - Uploads photo for current authenticated user

|===
|Формат запроса|Обязательность|Тело запроса|Пример запроса
|multipart/form-data
|false
|-
a|
-
|===
Список кодов ответа
|===
|Код ответа|Описание|Формат ответа|Пример ответа
|401
|Not authorized
|application/json
a|
[source,json]
----
{
  "error" : "unauthorized",
  "error_description" : "Full authentication is required to access this resource"
}
----
|400
|Bad request
|-
a|
-
|===

== Unlocks user

*POST*
*/users/unlock* - Unlocks user

|===
|Название параметра|Описание параметра|Тип|Тип данных|Мин. длина|Макс. длина
|userId*
|User id
|query
|integer (int64)
|-
|-
|===
Список кодов ответа
|===
|Код ответа|Описание|Формат ответа|Пример ответа
|401
|Not authorized
|application/json
a|
[source,json]
----
{
  "error" : "unauthorized",
  "error_description" : "Full authentication is required to access this resource"
}
----
|403
|Permission denied
|-
a|
-
|400
|Bad request
|-
a|
-
|===

== Enable/disable tfa for current authenticated user

*POST*
*/users/tfa* - Enable/disable tfa for current authenticated user

|===
|Название параметра|Описание параметра|Тип|Тип данных|Мин. длина|Макс. длина
|enabled*
|Tfa enabled flag
|query
|boolean 
|-
|-
|===
Список кодов ответа
|===
|Код ответа|Описание|Формат ответа|Пример ответа
|401
|Not authorized
|application/json
a|
[source,json]
----
{
  "error" : "unauthorized",
  "error_description" : "Full authentication is required to access this resource"
}
----
|403
|Permission denied
|-
a|
-
|400
|Bad request
|-
a|
-
|===

== Logout current user and revokes access/refresh token pair

*POST*
*/users/logout* - Logout current user and revokes access/refresh token pair

Список кодов ответа
|===
|Код ответа|Описание|Формат ответа|Пример ответа
|401
|Not authorized
|application/json
a|
[source,json]
----
{
  "error" : "unauthorized",
  "error_description" : "Full authentication is required to access this resource"
}
----
|===

== Locks user

*POST*
*/users/lock* - Locks user

|===
|Название параметра|Описание параметра|Тип|Тип данных|Мин. длина|Макс. длина
|userId*
|User id
|query
|integer (int64)
|-
|-
|===
Список кодов ответа
|===
|Код ответа|Описание|Формат ответа|Пример ответа
|401
|Not authorized
|application/json
a|
[source,json]
----
{
  "error" : "unauthorized",
  "error_description" : "Full authentication is required to access this resource"
}
----
|403
|Permission denied
|-
a|
-
|400
|Bad request
|-
a|
-
|===

== Finds users with specified options

*POST*
*/users/list* - Finds users with specified options

|===
|Формат запроса|Обязательность|Тело запроса|Пример запроса
|application/json
|true
|<<PageRequestDto>>
a|
[source,json]
----
{
  "page" : 0,
  "size" : 25
}
----
|===
Список кодов ответа
|===
|Код ответа|Описание|Формат ответа|Пример ответа
|401
|Not authorized
|application/json
a|
[source,json]
----
{
  "error" : "unauthorized",
  "error_description" : "Full authentication is required to access this resource"
}
----
|403
|Permission denied
|*/*
a|
-
|400
|Bad request
|application/json
a|
[source,json]
----
[ {
  "fieldName" : "page",
  "code" : "Min",
  "errorMessage" : "must be greater than or equal to 0"
}, {
  "fieldName" : "size",
  "code" : "Min",
  "errorMessage" : "must be greater than or equal to 1"
} ]
----
|===

== Creates new user

*POST*
*/users/create* - Creates new user

|===
|Формат запроса|Обязательность|Тело запроса|Пример запроса
|application/json
|true
|<<CreateUserDto>>
a|
-
|===
Список кодов ответа
|===
|Код ответа|Описание|Формат ответа|Пример ответа
|401
|Not authorized
|application/json
a|
[source,json]
----
{
  "error" : "unauthorized",
  "error_description" : "Full authentication is required to access this resource"
}
----
|403
|Permission denied
|*/*
a|
-
|400
|Bad request
|application/json
a|
[source,json]
----
[ {
  "fieldName" : "login",
  "code" : "UniqueLogin",
  "errorMessage" : null
} ]
----
|===

== Verify reset password token

*POST*
*/password/verify-token* - Verify reset password token

|===
|Название параметра|Описание параметра|Тип|Тип данных|Мин. длина|Макс. длина
|token*
|Reset password token
|query
|string 
|-
|-
|===
Список кодов ответа
|===
|Код ответа|Описание|Формат ответа|Пример ответа
|200
|OK
|*/*
a|
-
|===

== Reset password with specified token

*POST*
*/password/reset* - Reset password with specified token

|===
|Формат запроса|Обязательность|Тело запроса|Пример запроса
|application/json
|true
|<<ResetPasswordRequest>>
a|
-
|===
Список кодов ответа
|===
|Код ответа|Описание|Формат ответа|Пример ответа
|200
|OK
|-
a|
-
|===

== Creates forgot password request

*POST*
*/password/forgot* - Creates forgot password request

|===
|Формат запроса|Обязательность|Тело запроса|Пример запроса
|application/json
|true
|<<ForgotPasswordRequest>>
a|
-
|===
Список кодов ответа
|===
|Код ответа|Описание|Формат ответа|Пример ответа
|200
|OK
|-
a|
-
|===

== Creates change password request

*POST*
*/password/change/request* - Creates change password request

|===
|Формат запроса|Обязательность|Тело запроса|Пример запроса
|application/json
|true
|<<ChangePasswordRequest>>
a|
-
|===
Список кодов ответа
|===
|Код ответа|Описание|Формат ответа|Пример ответа
|200
|OK
|-
a|
-
|===

== Confirms change password request

*POST*
*/password/change/confirm* - Confirms change password request

|===
|Название параметра|Описание параметра|Тип|Тип данных|Мин. длина|Макс. длина
|token*
|Token value
|query
|string 
|-
|-
|===
Список кодов ответа
|===
|Код ответа|Описание|Формат ответа|Пример ответа
|200
|OK
|-
a|
-
|===

== Creates change email request

*POST*
*/email/change/request* - Creates change email request

|===
|Название параметра|Описание параметра|Тип|Тип данных|Мин. длина|Макс. длина
|newEmail*
|User email
|query
|string 
|0
|255
|===
Список кодов ответа
|===
|Код ответа|Описание|Формат ответа|Пример ответа
|200
|OK
|-
a|
-
|===

== Confirms change email request

*POST*
*/email/change/confirm* - Confirms change email request

|===
|Название параметра|Описание параметра|Тип|Тип данных|Мин. длина|Макс. длина
|token*
|Token value
|query
|string 
|-
|-
|===
Список кодов ответа
|===
|Код ответа|Описание|Формат ответа|Пример ответа
|200
|OK
|-
a|
-
|===

== Gets current authenticated user info

*GET*
*/users/user-info* - Gets current authenticated user info

Список кодов ответа
|===
|Код ответа|Описание|Формат ответа|Пример ответа
|401
|Not authorized
|application/json
a|
[source,json]
----
{
  "error" : "unauthorized",
  "error_description" : "Full authentication is required to access this resource"
}
----
|===

== Downloads user photo

*GET*
*/users/photo/{id}* - Downloads user photo

|===
|Название параметра|Описание параметра|Тип|Тип данных|Мин. длина|Макс. длина
|id*
|Photo id
|path
|integer (int64)
|-
|-
|===
Список кодов ответа
|===
|Код ответа|Описание|Формат ответа|Пример ответа
|401
|Not authorized
|application/json
a|
[source,json]
----
{
  "error" : "unauthorized",
  "error_description" : "Full authentication is required to access this resource"
}
----
|400
|Bad request
|*/*
a|
-
|===

== Deletes photo for current authenticated user

*DELETE*
*/users/delete-photo* - Deletes photo for current authenticated user

Список кодов ответа
|===
|Код ответа|Описание|Формат ответа|Пример ответа
|401
|Not authorized
|application/json
a|
[source,json]
----
{
  "error" : "unauthorized",
  "error_description" : "Full authentication is required to access this resource"
}
----
|400
|Bad request
|-
a|
-
|===


== Описание форматов для запросов
=== UpdateUserInfoDto
:table-caption: Таблица
.Update user info model
|===
|Название параметра|Описание параметра|Тип данных|Мин. длина|Макс. длина|Паттерн
|*firstName**
|First name
|string 
|2
|30
|`^([A-Z][a-z]+)\|([А-Я][а-я]+)$`
|*lastName**
|Last name
|string 
|2
|30
|`^([A-Z][a-z]+)\|([А-Я][а-я]+)$`
|*middleName**
|Middle name
|string 
|2
|30
|`^([A-Z][a-z]+)\|([А-Я][а-я]+)$`
|===
=== FilterRequestDto
:table-caption: Таблица
.Filter request model
|===
|Название параметра|Описание параметра|Тип данных|Мин. длина|Макс. длина|Паттерн
|*name**
|Filter column name
|string 
|0
|255
|-
|*values*
|-
|array 
|-
|-
|-
|*matchMode**
|Match mode type
|string 
|-
|-
|-
|===
=== PageRequestDto
:table-caption: Таблица
.Page request model
|===
|Название параметра|Описание параметра|Тип данных|Мин. длина|Макс. длина|Паттерн
|*page**
|Page number
|integer (int32)
|-
|-
|-
|*size**
|Page size
|integer (int32)
|-
|-
|-
|*sortField*
|Sort field
|string 
|0
|255
|-
|*ascending*
|Is ascending sort?
|boolean 
|-
|-
|-
|*searchQuery*
|Search query string
|string 
|0
|255
|-
|*filters*
|Filters list
|array 
|-
|-
|-
|===
=== PageDtoUserDto
:table-caption: Таблица
.Page model
|===
|Название параметра|Описание параметра|Тип данных|Мин. длина|Макс. длина|Паттерн
|*content*
|Page content
|array 
|-
|-
|-
|*page*
|Page number
|integer (int32)
|-
|-
|-
|*totalCount*
|Total elements count in all pages
|integer (int64)
|-
|-
|-
|===
=== RoleDto
:table-caption: Таблица
.User role model
|===
|Название параметра|Описание параметра|Тип данных|Мин. длина|Макс. длина|Паттерн
|*roleName*
|Role name
|string 
|-
|-
|-
|*description*
|Role description
|string 
|-
|-
|-
|===
=== UserDto
:table-caption: Таблица
.User model
|===
|Название параметра|Описание параметра|Тип данных|Мин. длина|Макс. длина|Паттерн
|*id*
|User id
|integer (int64)
|-
|-
|-
|*login*
|User login
|string 
|-
|-
|-
|*email*
|User email
|string 
|-
|-
|-
|*firstName*
|User first name
|string 
|-
|-
|-
|*lastName*
|User last name
|string 
|-
|-
|-
|*middleName*
|User middle name
|string 
|-
|-
|-
|*fullName*
|User full name
|string 
|-
|-
|-
|*creationDate*
|User creation date
|string 
|-
|-
|-
|*tfaEnabled*
|Two factor authentication enabled
|boolean 
|-
|-
|-
|*locked*
|Account locked
|boolean 
|-
|-
|-
|*photoId*
|User photo id
|integer (int64)
|-
|-
|-
|*passwordDate*
|Last password change date
|string 
|-
|-
|-
|*roles*
|User roles
|array 
|-
|-
|-
|===
=== CreateUserDto
:table-caption: Таблица
.Create user model
|===
|Название параметра|Описание параметра|Тип данных|Мин. длина|Макс. длина|Паттерн
|*login**
|User login
|string 
|3
|32
|`^[a-z0-9]+$`
|*email**
|User email
|string 
|0
|255
|-
|*firstName**
|First name
|string 
|2
|30
|`^([A-Z][a-z]+)\|([А-Я][а-я]+)$`
|*lastName**
|Last name
|string 
|2
|30
|`^([A-Z][a-z]+)\|([А-Я][а-я]+)$`
|*middleName**
|Middle name
|string 
|2
|30
|`^([A-Z][a-z]+)\|([А-Я][а-я]+)$`
|===
=== ResetPasswordRequest
:table-caption: Таблица
.Reset password request model
|===
|Название параметра|Описание параметра|Тип данных|Мин. длина|Макс. длина|Паттерн
|*token**
|Token value
|string 
|-
|-
|-
|*password**
|New password
|string 
|-
|-
|-
|===
=== ForgotPasswordRequest
:table-caption: Таблица
.Forgot password request model
|===
|Название параметра|Описание параметра|Тип данных|Мин. длина|Макс. длина|Паттерн
|*email**
|User email
|string 
|-
|-
|-
|===
=== ChangePasswordRequest
:table-caption: Таблица
.Change password request model
|===
|Название параметра|Описание параметра|Тип данных|Мин. длина|Макс. длина|Паттерн
|*oldPassword**
|Old password
|string 
|-
|-
|-
|*newPassword**
|New password
|string 
|-
|-
|-
|===

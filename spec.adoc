= Microservice for users managment
Автор: Roman Batygin <roman.batygin@mail.ru>
:toc:
:toc-title: Оглавление

== Описание

API provides operations with users for ECA web application

== Updates info for current authenticated user

*PUT*
*/users/update-info* - Updates info for current authenticated user

|===
|Формат запроса|Обязательность|Тело запроса
|application/json
|true
|<<UpdateUserInfoDto>>
|===
== Uploads photo for current authenticated user

*POST*
*/users/upload-photo* - Uploads photo for current authenticated user

|===
|Формат запроса|Обязательность|Тело запроса
|multipart/form-data
|false
|-
|===
== Unlocks user

*POST*
*/users/unlock* - Unlocks user

|===
|Название параметра|Описание параметра|Тип|Тип данных|Обязательность|Мин. длина|Макс. длина
|userId
|User id
|query
|integer (int64)
|true
|-
|-
|===
== Enable/disable tfa for current authenticated user

*POST*
*/users/tfa* - Enable/disable tfa for current authenticated user

|===
|Название параметра|Описание параметра|Тип|Тип данных|Обязательность|Мин. длина|Макс. длина
|enabled
|Tfa enabled flag
|query
|boolean 
|true
|-
|-
|===
== Logout current user and revokes access/refresh token pair

*POST*
*/users/logout* - Logout current user and revokes access/refresh token pair

== Locks user

*POST*
*/users/lock* - Locks user

|===
|Название параметра|Описание параметра|Тип|Тип данных|Обязательность|Мин. длина|Макс. длина
|userId
|User id
|query
|integer (int64)
|true
|-
|-
|===
== Finds users with specified options

*POST*
*/users/list* - Finds users with specified options

|===
|Формат запроса|Обязательность|Тело запроса
|application/json
|true
|<<PageRequestDto>>
|===
[source,json]
----
{
  "page" : 0,
  "size" : 25
}
----
== Creates new user

*POST*
*/users/create* - Creates new user

|===
|Формат запроса|Обязательность|Тело запроса
|application/json
|true
|<<CreateUserDto>>
|===
== Verify reset password token

*POST*
*/password/verify-token* - Verify reset password token

|===
|Название параметра|Описание параметра|Тип|Тип данных|Обязательность|Мин. длина|Макс. длина
|token
|Reset password token
|query
|string 
|true
|-
|-
|===
== Reset password with specified token

*POST*
*/password/reset* - Reset password with specified token

|===
|Формат запроса|Обязательность|Тело запроса
|application/json
|true
|<<ResetPasswordRequest>>
|===
== Creates forgot password request

*POST*
*/password/forgot* - Creates forgot password request

|===
|Формат запроса|Обязательность|Тело запроса
|application/json
|true
|<<ForgotPasswordRequest>>
|===
== Creates change password request

*POST*
*/password/change/request* - Creates change password request

|===
|Формат запроса|Обязательность|Тело запроса
|application/json
|true
|<<ChangePasswordRequest>>
|===
== Confirms change password request

*POST*
*/password/change/confirm* - Confirms change password request

|===
|Название параметра|Описание параметра|Тип|Тип данных|Обязательность|Мин. длина|Макс. длина
|token
|Token value
|query
|string 
|true
|-
|-
|===
== Creates change email request

*POST*
*/email/change/request* - Creates change email request

|===
|Название параметра|Описание параметра|Тип|Тип данных|Обязательность|Мин. длина|Макс. длина
|newEmail
|User email
|query
|string 
|true
|0
|255
|===
== Confirms change email request

*POST*
*/email/change/confirm* - Confirms change email request

|===
|Название параметра|Описание параметра|Тип|Тип данных|Обязательность|Мин. длина|Макс. длина
|token
|Token value
|query
|string 
|true
|-
|-
|===
== Gets current authenticated user info

*GET*
*/users/user-info* - Gets current authenticated user info

== Downloads user photo

*GET*
*/users/photo/{id}* - Downloads user photo

|===
|Название параметра|Описание параметра|Тип|Тип данных|Обязательность|Мин. длина|Макс. длина
|id
|Photo id
|path
|integer (int64)
|true
|-
|-
|===
== Deletes photo for current authenticated user

*DELETE*
*/users/delete-photo* - Deletes photo for current authenticated user


== Описание форматов для запросов
=== UpdateUserInfoDto - Update user info model
|Название параметра|Описание параметра|Тип данных|Обязательность|Мин. длина|Макс. длина|Паттерн
|firstName
|First name
|string 
|true
|2
|30
|^([A-Z][a-z]+)|([А-Я][а-я]+)$
|lastName
|Last name
|string 
|true
|2
|30
|^([A-Z][a-z]+)|([А-Я][а-я]+)$
|middleName
|Middle name
|string 
|true
|2
|30
|^([A-Z][a-z]+)|([А-Я][а-я]+)$
|===
=== FilterRequestDto - Filter request model
|Название параметра|Описание параметра|Тип данных|Обязательность|Мин. длина|Макс. длина|Паттерн
|name
|Filter column name
|string 
|true
|0
|255
|-
|values
|-
|array 
|false
|-
|-
|-
|matchMode
|Match mode type
|string 
|true
|-
|-
|-
|===
=== PageRequestDto - Page request model
|Название параметра|Описание параметра|Тип данных|Обязательность|Мин. длина|Макс. длина|Паттерн
|page
|Page number
|integer (int32)
|true
|-
|-
|-
|size
|Page size
|integer (int32)
|true
|-
|-
|-
|sortField
|Sort field
|string 
|false
|0
|255
|-
|ascending
|Is ascending sort?
|boolean 
|false
|-
|-
|-
|searchQuery
|Search query string
|string 
|false
|0
|255
|-
|filters
|Filters list
|array 
|false
|-
|-
|-
|===
=== PageDtoUserDto - Page model
|Название параметра|Описание параметра|Тип данных|Обязательность|Мин. длина|Макс. длина|Паттерн
|content
|Page content
|array 
|false
|-
|-
|-
|page
|Page number
|integer (int32)
|false
|-
|-
|-
|totalCount
|Total elements count in all pages
|integer (int64)
|false
|-
|-
|-
|===
=== RoleDto - User role model
|Название параметра|Описание параметра|Тип данных|Обязательность|Мин. длина|Макс. длина|Паттерн
|roleName
|Role name
|string 
|false
|-
|-
|-
|description
|Role description
|string 
|false
|-
|-
|-
|===
=== UserDto - User model
|Название параметра|Описание параметра|Тип данных|Обязательность|Мин. длина|Макс. длина|Паттерн
|id
|User id
|integer (int64)
|false
|-
|-
|-
|login
|User login
|string 
|false
|-
|-
|-
|email
|User email
|string 
|false
|-
|-
|-
|firstName
|User first name
|string 
|false
|-
|-
|-
|lastName
|User last name
|string 
|false
|-
|-
|-
|middleName
|User middle name
|string 
|false
|-
|-
|-
|fullName
|User full name
|string 
|false
|-
|-
|-
|creationDate
|User creation date
|string 
|false
|-
|-
|-
|tfaEnabled
|Two factor authentication enabled
|boolean 
|false
|-
|-
|-
|locked
|Account locked
|boolean 
|false
|-
|-
|-
|photoId
|User photo id
|integer (int64)
|false
|-
|-
|-
|passwordDate
|Last password change date
|string 
|false
|-
|-
|-
|roles
|User roles
|array 
|false
|-
|-
|-
|===
=== CreateUserDto - Create user model
|Название параметра|Описание параметра|Тип данных|Обязательность|Мин. длина|Макс. длина|Паттерн
|login
|User login
|string 
|true
|3
|32
|^[a-z0-9]+$
|email
|User email
|string 
|true
|0
|255
|-
|firstName
|First name
|string 
|true
|2
|30
|^([A-Z][a-z]+)|([А-Я][а-я]+)$
|lastName
|Last name
|string 
|true
|2
|30
|^([A-Z][a-z]+)|([А-Я][а-я]+)$
|middleName
|Middle name
|string 
|true
|2
|30
|^([A-Z][a-z]+)|([А-Я][а-я]+)$
|===
=== ResetPasswordRequest - Reset password request model
|Название параметра|Описание параметра|Тип данных|Обязательность|Мин. длина|Макс. длина|Паттерн
|token
|Token value
|string 
|true
|-
|-
|-
|password
|New password
|string 
|true
|-
|-
|-
|===
=== ForgotPasswordRequest - Forgot password request model
|Название параметра|Описание параметра|Тип данных|Обязательность|Мин. длина|Макс. длина|Паттерн
|email
|User email
|string 
|true
|-
|-
|-
|===
=== ChangePasswordRequest - Change password request model
|Название параметра|Описание параметра|Тип данных|Обязательность|Мин. длина|Макс. длина|Паттерн
|oldPassword
|Old password
|string 
|true
|-
|-
|-
|newPassword
|New password
|string 
|true
|-
|-
|-
|===

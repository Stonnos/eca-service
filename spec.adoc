= Microservice for sending emails
Автор: Roman Batygin <roman.batygin@mail.ru>
:toc:
:toc-title: Оглавление

== Описание

API provides operations for email notifications sending

== Finds email templates with specified options such as filter, sorting and paging

*POST*
*/templates/list* - Finds email templates with specified options such as filter, sorting and paging

|===
|Формат запроса|Обязательность|Тело запроса|Пример запроса
|application/json
|true
|<<PageRequestDto>>
a|
[source,json]
----
{
  "page" : 0,
  "size" : 25
}
----
|===

*Список кодов ответа*
|===
|Код ответа|Описание|Формат ответа|Пример ответа
|200
|OK
|application/json
a|
[source,json]
----
{
  "content" : [ {
    "id" : 1,
    "created" : "2021-07-01 14:00:00",
    "code" : "NEW_EXPERIMENT",
    "description" : "New experiment",
    "subject" : "New experiment request",
    "body" : "some body",
    "parameters" : [ {
      "id" : 1,
      "created" : "2021-07-01 14:00:00",
      "parameterName" : "requestId",
      "description" : "Experiment request id"
    } ]
  } ],
  "page" : 0,
  "totalCount" : 1
}
----
|401
|Not authorized
|application/json
a|
[source,json]
----
{
  "error" : "unauthorized",
  "error_description" : "Full authentication is required to access this resource"
}
----
|400
|Bad request
|application/json
a|
[source,json]
----
[ {
  "fieldName" : "page",
  "code" : "Min",
  "errorMessage" : "must be greater than or equal to 0"
}, {
  "fieldName" : "size",
  "code" : "Min",
  "errorMessage" : "must be greater than or equal to 1"
} ]
----
|===

== Saves email request to sent

*POST*
*/emails/email-request* - Saves email request to sent

|===
|Формат запроса|Обязательность|Тело запроса|Пример запроса
|application/json
|true
|<<EmailRequest>>
a|
[source,json]
----
{
  "receiver" : "test@mail.ru",
  "templateCode" : "NEW_EXPERIMENT",
  "variables" : {
    "firstName" : "Роман",
    "requestId" : "1cec4e54-0f46-4d70-ad19-a8f9f1a0e33c",
    "experimentType" : "KNN"
  },
  "priority" : 1
}
----
|===

*Список кодов ответа*
|===
|Код ответа|Описание|Формат ответа|Пример ответа
|200
|OK
|application/json
a|
[source,json]
----
{
  "requestId" : "1d2de514-3a87-4620-9b97-c260e24340de"
}
----
|400
|Bad request
|application/json
a|
[source,json]
----
[ {
  "fieldName" : "templateCode",
  "code" : "ValidEmailRequest",
  "errorMessage" : "Invalid template code!"
} ]
----
|===


== Описание форматов для запросов
=== FilterRequestDto
:table-caption: Таблица
.Filter request model
|===
|Название параметра|Описание параметра|Тип данных|Мин. длина|Макс. длина|Паттерн
|*name**
|Filter column name
|
string
|0
|255
|-
|*values*
|-
|
array
|-
|-
|-
|*matchMode**
|Match mode type
|
string
|-
|-
|-
|===
=== PageRequestDto
:table-caption: Таблица
.Page request model
|===
|Название параметра|Описание параметра|Тип данных|Мин. длина|Макс. длина|Паттерн
|*page**
|Page number
|
integer
(int32)
|-
|-
|-
|*size**
|Page size
|
integer
(int32)
|-
|-
|-
|*sortField*
|Sort field
|
string
|0
|255
|-
|*ascending*
|Is ascending sort?
|
boolean
|-
|-
|-
|*searchQuery*
|Search query string
|
string
|0
|255
|-
|*filters*
|Filters list
|
array
|-
|-
|-
|===
=== EmailRequest
:table-caption: Таблица
.Email request
|===
|Название параметра|Описание параметра|Тип данных|Мин. длина|Макс. длина|Паттерн
|*receiver**
|Receiver email
|
string
|0
|255
|-
|*templateCode**
|Email template code
|
string
|-
|-
|-
|*variables*
|-
|
array
|-
|-
|-
|*priority**
|Delivery priority
|
integer
(int32)
|-
|-
|-
|===

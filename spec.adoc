= Evaluation external API micriservice
Автор: Roman Batygin <roman.batygin@mail.ru>
:toc:
:toc-title: Table of contents

== Overview

API provides operations to performs classifiers evaluation requests

== Uploads train data file

__POST__ */uploads-train-data* - Uploads train data file

|===
|Content type|Required|Schema|Example
|*multipart/form-data*
|false
|-
a|
-
|===

*Список кодов ответа*
|===
|Code|Description|Content type|Schema|Example
|200
|OK
|*application/json*
|<<InstancesResponseDto>>
a|
[source,json]
----
{
  "payload" : {
    "dataId" : "2a35bffe-27ad-4a50-a7e0-8c871cfd7cc5",
    "dataUrl" : "data://2a35bffe-27ad-4a50-a7e0-8c871cfd7cc5"
  },
  "responseCode" : "SUCCESS",
  "errorDescription" : null
}
----
|401
|Not authorized
|*application/json*
|-
a|
[source,json]
----
{
  "error" : "unauthorized",
  "error_description" : "Full authentication is required to access this resource"
}
----
|400
|Bad request
|*application/json*
|-
a|
[source,json]
----
{
  "payload" : [ {
    "fieldName" : "trainingData",
    "code" : "ValidTrainData",
    "errorMessage" : "Invalid train data extension. Must be one of xls, xlsx, csv, arff, json, xml, txt, data, docx"
  } ],
  "responseCode" : "VALIDATION_ERROR",
  "errorDescription" : "Validation errors"
}
----
|===

== Processes evaluation request

__POST__ */evaluation-request* - Processes evaluation request

|===
|Content type|Required|Schema|Example
|*application/json*
|true
|<<EvaluationRequestDto>>
a|
[source,json]
----
{
  "trainDataUrl" : "http://kt.ijs.si/Branax/Repository/WEKA/Iris.xls",
  "classifierOptions" : {
    "type" : "logistic",
    "maxIts" : 200,
    "useConjugateGradientDescent" : false
  },
  "evaluationMethod" : "CROSS_VALIDATION",
  "numFolds" : 10,
  "numTests" : 1,
  "seed" : 1
}
----
|===

*Список кодов ответа*
|===
|Code|Description|Content type|Schema|Example
|200
|OK
|*application/json*
|<<EvaluationResponseWrapperDto>>
a|
[source,json]
----
{
  "payload" : {
    "requestId" : "1cbe6c49-8432-4c81-9afa-90f04a803fed",
    "evaluationStatus" : "IN_PROGRESS",
    "modelUrl" : null,
    "numTestInstances" : null,
    "numCorrect" : null,
    "numIncorrect" : null,
    "pctCorrect" : null,
    "pctIncorrect" : null,
    "meanAbsoluteError" : null
  },
  "responseCode" : "SUCCESS",
  "errorDescription" : null
}
----
|401
|Not authorized
|*application/json*
|-
a|
[source,json]
----
{
  "error" : "unauthorized",
  "error_description" : "Full authentication is required to access this resource"
}
----
|400
|Bad request
|*application/json*
|-
a|
[source,json]
----
{
  "payload" : [ {
    "fieldName" : "classifierOptions",
    "code" : "NotNull",
    "errorMessage" : "must not be null"
  }, {
    "fieldName" : "evaluationMethod",
    "code" : "NotNull",
    "errorMessage" : "must not be null"
  } ],
  "responseCode" : "VALIDATION_ERROR",
  "errorDescription" : "Validation errors"
}
----
|===

== Gets evaluation response status

__GET__ */evaluation-status/{requestId}* - Gets evaluation response status


*Request parameters*
|===
|Name|Description|Type|Schema
|*requestId**
|Request id
|path
a|__string__ 







|===

*Список кодов ответа*
|===
|Code|Description|Content type|Schema|Example
|200
|OK
|*application/json*
|<<ResponseDto>>
a|
[source,json]
----
{
  "payload" : {
    "requestId" : "1cbe6c49-8432-4c81-9afa-90f04a803fed",
    "evaluationStatus" : "FINISHED",
    "modelUrl" : "http://localhost:8080/external-api/download-model/1cbe6c49-8432-4c81-9afa-90f04a803fed",
    "numTestInstances" : 150,
    "numCorrect" : 144,
    "numIncorrect" : 6,
    "pctCorrect" : 96,
    "pctIncorrect" : 4,
    "meanAbsoluteError" : 0.02869334024628254
  },
  "responseCode" : "SUCCESS",
  "errorDescription" : null
}
----
|401
|Not authorized
|*application/json*
|-
a|
[source,json]
----
{
  "error" : "unauthorized",
  "error_description" : "Full authentication is required to access this resource"
}
----
|400
|Bad request
|*application/json*
|-
a|
[source,json]
----
{
  "payload" : [ {
    "fieldName" : null,
    "code" : "DataNotFound",
    "errorMessage" : "Entity with search key [1] not found!"
  } ],
  "responseCode" : "VALIDATION_ERROR",
  "errorDescription" : "Validation errors"
}
----
|===

== Downloads classifier model

__GET__ */download-model/{requestId}* - Downloads classifier model


*Request parameters*
|===
|Name|Description|Type|Schema
|*requestId**
|Request id
|path
a|__string__ 







|===

*Список кодов ответа*
|===
|Code|Description|Content type|Schema|Example
|200
|OK
|**/**
|-
a|
-
|401
|Not authorized
|*application/json*
|-
a|
[source,json]
----
{
  "error" : "unauthorized",
  "error_description" : "Full authentication is required to access this resource"
}
----
|400
|Bad request
|*application/json*
|-
a|
[source,json]
----
{
  "payload" : [ {
    "fieldName" : null,
    "code" : "DataNotFound",
    "errorMessage" : "Entity with search key [1] not found!"
  } ],
  "responseCode" : "VALIDATION_ERROR",
  "errorDescription" : "Validation errors"
}
----
|===


== Components
=== InstancesDto
:table-caption: Table
.Instances model
|===
|Name|Description|Schema
|*dataId*
|Data id
a|
__string__







|*dataUrl*
|Train data url in internal format data://dataId
a|
__string__







|===
=== InstancesResponseDto
:table-caption: Table
.Instances response wrapper model
|===
|Name|Description|Schema
|*payload*
|-
a|<<InstancesDto>>







|*responseCode*
|Response code
a|
__string__







*Values*:

* SUCCESS

* VALIDATION_ERROR

* DATA_NOT_FOUND

* ERROR

* TIMEOUT

* SERVICE_UNAVAILABLE
|*errorDescription*
|Error message
a|
__string__







|===
=== EvaluationResponseDto
:table-caption: Table
.Evaluation response model
|===
|Name|Description|Schema
|*requestId*
|Evaluation request id
a|
__string__







|*evaluationStatus*
|Evaluation status
a|
__string__







*Values*:

* IN_PROGRESS

* FINISHED

* TIMEOUT

* ERROR
|*modelUrl*
|Model url
a|
__string__







|*numTestInstances*
|Test instances number
a|
__integer__
__(int32)__







|*numCorrect*
|Correctly classified instances number
a|
__integer__
__(int32)__







|*numIncorrect*
|Incorrectly classified instances number
a|
__integer__
__(int32)__







|*pctCorrect*
|Correctly classified percentage
a|
__number__







|*pctIncorrect*
|Incorrectly classified percentage
a|
__number__







|*meanAbsoluteError*
|Mean absolute error
a|
__number__







|===
=== EvaluationResponseWrapperDto
:table-caption: Table
.Evaluation response wrapper model
|===
|Name|Description|Schema
|*payload*
|-
a|<<EvaluationResponseDto>>







|*responseCode*
|Response code
a|
__string__







*Values*:

* SUCCESS

* VALIDATION_ERROR

* DATA_NOT_FOUND

* ERROR

* TIMEOUT

* SERVICE_UNAVAILABLE
|*errorDescription*
|Error message
a|
__string__







|===
=== ActivationFunctionOptions
:table-caption: Table
.Component ActivationFunctionOptions
|===
|Name|Description|Schema
|*activationFunctionType*
|-
a|
__string__







*Values*:

* LOGISTIC

* HYPERBOLIC_TANGENT

* SINUSOID

* EXPONENTIAL

* SOFT_SIGN

* INVERSE_SQUARE_ROOT_UNIT
|*coefficient*
|-
a|
__number__
__(double)__







|===
=== BackPropagationOptions
:table-caption: Table
.Component BackPropagationOptions
|===
|Name|Description|Schema
|*learningRate*
|-
a|
__number__
__(double)__







|*momentum*
|-
a|
__number__
__(double)__







|===
=== ClassifierOptions
:table-caption: Table
.Classifier options json
|===
|Name|Description|Schema
|*type**
|-
a|
__string__







|===
=== DecisionTreeOptions
=== EvaluationRequestDto
:table-caption: Table
.Evaluation request model
|===
|Name|Description|Schema
|*trainDataUrl**
|Train data url
a|
__string__







|*classifierOptions**
|-
a|






|*evaluationMethod**
|Evaluation method
a|
__string__







*Values*:

* TRAINING_DATA

* CROSS_VALIDATION
|*numFolds*
|Folds number for k * V cross - validation method
a|
__integer__
__(int32)__







|*numTests*
|Tests number for k * V cross - validation method
a|
__integer__
__(int32)__







|*seed*
|Seed value for k * V cross - validation method
a|
__integer__
__(int32)__







|===
=== IterativeEnsembleOptions
=== J48Options
=== KNearestNeighboursOptions
=== LogisticOptions
=== NeuralNetworkOptions
=== StackingOptions
=== ResponseDto
:table-caption: Table
.Response model
|===
|Name|Description|Schema
|*payload*
|Response payload
a|
__object__







|*responseCode*
|Response code
a|
__string__







*Values*:

* SUCCESS

* VALIDATION_ERROR

* DATA_NOT_FOUND

* ERROR

* TIMEOUT

* SERVICE_UNAVAILABLE
|*errorDescription*
|Error message
a|
__string__







|===
